<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Data Admin - AYMP UNJAYA</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='lodaf/unjaya.png') }}" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/bootstrap.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- <link rel="stylesheet" href="assets/vendors/jquery-datatables/jquery.dataTables.min.css"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/jquery-datatables/jquery.dataTables.bootstrap5.min.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-papm6Q+..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/choices.js/choices.min.css') }}">


    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/perfect-scrollbar/perfect-scrollbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/bootstrap-icons/bootstrap-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/app.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/responsive-admin.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='assets/images/favicon.svg') }}" type="image/x-icon">
    
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <!-- Animate.css untuk animasi statistik -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        .info-item {
            transition: all 0.3s ease;
        }
        .info-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .bg-light {
            transition: all 0.3s ease;
        }
        .bg-light:hover {
            background-color: #e9ecef !important;
            transform: scale(1.02);
        }
        .statistik-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between">
                        <div class="logo">
                            <a href="{{ url_for('admin.das_admin') }}"><img src="{{ url_for('static', filename='assets/images/logo/logo.svg') }}" style="width: 110px; height: auto;" alt="Logo" srcset=""></a>
                        </div>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>

                        <li class="sidebar-item ">
                            <a href="{{ url_for('admin.das_admin') }}" class='sidebar-link'>
                                <i class="bi bi-speedometer2"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item ">
                            <a href="{{ url_for('admin.admin_daftar_bimbingan_mahasiswa') }}" class='sidebar-link'>
                                <i class="bi bi-chat-dots"></i>
                                <span>Bimbingan Mahasiswa</span>
                            </a>
                        </li>
                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-people-fill"></i>
                                <span>Mahasiswa</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="{{ url_for('admin.mahasiswa_belum_diverifikasi') }}">Belum Diverifikasi</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="{{ url_for('admin.mahasiswa_sudah_diverifikasi') }}">Sudah Diverifikasi</a> 
                                </li>
                            </ul>
                        </li>
                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi-bar-chart-line"></i>
                                <span>Monitoring Mahasiswa</span>
                            </a>
                            <ul class="submenu ">
                                <li class="submenu-item">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_produksi') }}">Produksi</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_alat_produksi') }}">Alat Produksi</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_biaya_operasional') }}">Biaya Operasional</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_biaya_non_operasional') }}">Biaya Lain-lain</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_penjualan_produk') }}">Penjualan Produk</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_laporan_laba_rugi') }}">Laporan Laba Rugi</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_laporan_arus_kas') }}">Laporan Arus Kas</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_monitoring_mahasiswa_laporan_neraca') }}">Laporan Neraca</a> 
                                </li>
                            </ul>
                        </li>
                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-clock-history"></i>
                                <span>Log Aktivitas</span>
                            </a>
                            <ul class="submenu ">

                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_daftar_log_mahasiswa') }}">Mahasiswa</a> 
                                </li>
                                <li class="submenu-item ">
                                    <a href="{{ url_for('admin.admin_daftar_log_pembimbing') }}">Pembimbing</a> 
                                </li>
                                
                            </ul>
                        </li>
                        <li class="sidebar-item ">
                            <a href="{{ url_for('admin.daftar_nilai_mahasiswa') }}" class='sidebar-link'>
                                <i class="bi bi-award"></i>
                                <span>Nilai Mahasiswa</span>
                            </a>
                        </li>
                        <li class="sidebar-item ">
                            <a href="{{ url_for('admin.pengajuan_proposal') }}" class='sidebar-link'>
                                <i class="bi bi-file-earmark-text"></i>
                                <span>Pengajuan Proposal</span>
                            </a>
                        </li>
                        <li class="sidebar-item  ">
                            <a href="{{ url_for('admin.admin_laporan_kemajuan') }}" class='sidebar-link'>
                                <i class="bi bi-graph-up"></i>
                                <span>Laporan Kemajuan</span>
                            </a>
                        </li>
                        <li class="sidebar-item  ">
                            <a href="{{ url_for('admin.admin_laporan_akhir') }}" class='sidebar-link'>
                                <i class="bi bi-clipboard-data"></i>
                                <span>Laporan Akhir</span>
                            </a>
                        </li>
                        <li class="sidebar-item  ">
                            <a href="{{ url_for('admin.admin_pembimbing') }}" class='sidebar-link'>
                                <i class="bi bi-person-badge"></i>
                                <span>Pembimbing</span>
                            </a>
                        </li>
                        <li class="sidebar-item  ">
                            <a href="{{ url_for('admin.reviewer') }}" class='sidebar-link'>
                                <i class="bi bi-person-badge"></i>
                                <span>Reviewer</span>
                            </a>
                                </li>
                        <li class="sidebar-item ">
                            <a href="{{ url_for('admin.data_admin') }}" class='sidebar-link'>
                                <i class="bi bi-person-badge"></i>
                                <span>Admin</span>
                            </a>
                        </li>
                        <li class="sidebar-item active">
                            <a href="{{ url_for('admin.pengaturan') }}" class='sidebar-link'>
                                <i class="bi bi-gear"></i>
                                <span>Pengaturan</span>
                            </a>
                        </li>
                                                  <li class="sidebar-item">
                             <a href="{{ url_for('index') }}" class='sidebar-link'>
                                 <i class="bi bi-box-arrow-right"></i>
                                 <span>Logout</span>
                             </a>
                         </li>

                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Pengaturan</h3>
                            <p class="text-subtitle text-muted" style="font-size:1.2rem;">Kelola pengaturan AYMP UNJAYA di sini.</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="{{ url_for('admin.das_admin') }}">Dashboard</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Pengaturan</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Basic Tables start -->
                <section class="section">
                    <div class="container-fluid mt-4">
                        <div class="row">
                            <!-- Sidebar Menu Pengaturan -->
                            <div class="col-lg-3 col-md-4 col-sm-12 mb-3">
                                <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:20px;">
                                    <h6 class="text-primary mb-3" style="font-weight:700;">
                                        <i class="bi bi-list me-2"></i>Menu Pengaturan
                                    </h6>
                                    <div class="list-group list-group-flush">
                                        <a href="#informasi" class="list-group-item list-group-item-action active" data-bs-toggle="list" role="tab">
                                            Informasi Sistem
                                        </a>
                                        <a href="#program-studi" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Program Studi
                                        </a>
                                        <a href="#penilaian-mahasiswa" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Penilaian Mahasiswa
                                        </a>
                                        <a href="#penilaian-proposal" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Penilaian Proposal
                                        </a>
                                        <a href="#penilaian-laporan-kemajuan" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Penilaian Laporan Kemajuan
                                        </a>
                                        <a href="#penilaian-laporan-akhir" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Penilaian Laporan Akhir
                                        </a>
                                        <a href="#pengaturan-default" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Pengaturan Default
                                        </a>
                                        <a href="#pengaturan-bimbingan" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Pengaturan Bimbingan
                                        </a>
                                        <a href="#pengaturan-jadwal" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Pengaturan Jadwal
                                        </a>
                                         <a href="#pengaturan-anggaran" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                             Pengaturan Anggaran
                                         </a>
                                         <a href="#pengaturan-jadwal-penilaian" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                             Pengaturan Jadwal Penilaian
                                         </a>
                                        <a href="#pengaturan-auto-fill" class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab">
                                            Pengaturan Auto-fill
                                        </a>

                                    </div>
                                </div>
                            </div>

                            <!-- Konten Utama -->
                            <div class="col-lg-9 col-md-8 col-sm-12">
                                <div class="tab-content">
                                    <!-- Tab Informasi Sistem -->
                                    <div class="tab-pane fade" id="informasi" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-info-circle me-2"></i>Informasi Sistem AYMP UNJAYA
                                                    </h5>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-primary mb-2">
                                                            <i class="bi bi-gear me-2"></i>Deskripsi Sistem
                                                        </h6>
                                                        <p class="text-muted mb-0">Sistem pengelolaan proposal dan monitoring mahasiswa untuk program AYMP (ACHMAD YANI MUDAPRENEUR) Universitas Jenderal Achmad Yani. Sistem ini dirancang untuk mendukung mahasiswa dalam mengembangkan usaha mikro dan menengah.</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-success mb-2">
                                                            <i class="bi bi-people me-2"></i>Fitur Utama
                                                        </h6>
                                                        <ul class="text-muted mb-0" style="list-style: none; padding-left: 0;">
                                                            <li><i class="bi bi-check-circle text-success me-2"></i>Pengelolaan proposal usaha mahasiswa</li>
                                                            <li><i class="bi bi-check-circle text-success me-2"></i>Monitoring progress produksi dan penjualan</li>
                                                            <li><i class="bi bi-check-circle text-success me-2"></i>Laporan keuangan (laba rugi, arus kas, neraca)</li>
                                                            <li><i class="bi bi-check-circle text-success me-2"></i>Manajemen pembimbing dan reviewer</li>
                                                            <li><i class="bi bi-check-circle text-success me-2"></i>Sistem penilaian otomatis</li>
                                                            <li><i class="bi bi-check-circle text-success me-2"></i>Pengaturan jadwal dan batas waktu</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-info mb-2">
                                                            <i class="bi bi-calendar me-2"></i>Versi Sistem
                                                        </h6>
                                                        <p class="text-muted mb-0">AYMP UNJAYA v2.1 - Sistem terbaru dengan fitur monitoring yang lebih lengkap, penilaian otomatis, dan dashboard yang responsif</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-warning mb-2">
                                                            <i class="bi bi-shield-check me-2"></i>Keamanan
                                                        </h6>
                                                        <p class="text-muted mb-0">Sistem dilengkapi dengan autentikasi multi-level, enkripsi data sensitif, dan logging aktivitas lengkap untuk audit trail</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-danger mb-2">
                                                            <i class="bi bi-building me-2"></i>Institusi
                                                        </h6>
                                                        <p class="text-muted mb-0">Universitas Jenderal Achmad Yani Yogyakarta<br>
                                                        <small class="text-info">Jl. Siliwangi Ringroad Barat, Banyuraden, Gamping, Sleman, Yogyakarta 55293</small></p>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-secondary mb-2">
                                                            <i class="bi bi-code-slash me-2"></i>Teknologi
                                                        </h6>
                                                        <ul class="text-muted mb-0" style="list-style: none; padding-left: 0;">
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Backend: Python Flask</li>
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Database: MySQL</li>
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Frontend: HTML5, CSS3, JavaScript</li>
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Framework: Bootstrap 5</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-dark mb-2">
                                                            <i class="bi bi-clock-history me-2"></i>Update Terakhir
                                                        </h6>
                                                        <p class="text-muted mb-0">Sistem diperbarui secara berkala dengan perbaikan bug, peningkatan performa, dan penambahan fitur baru sesuai kebutuhan pengguna.</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-primary mb-2">
                                                            <i class="bi bi-headset me-2"></i>Dukungan
                                                        </h6>
                                                        <p class="text-muted mb-0">Tim IT UNJAYA siap membantu untuk pertanyaan teknis dan pelaporan bug. Hubungi melalui email: <span class="text-info">it@unjaya.ac.id</span></p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-success mb-2">
                                                            <i class="bi bi-graph-up me-2"></i>Status Sistem
                                                        </h6>
                                                        <div class="row g-2">
                                                            <div class="col-6">
                                                                <div class="text-center p-2 bg-light rounded">
                                                                    <div class="text-success fw-bold">
                                                                        <i class="bi bi-check-circle-fill"></i> Online
                                                                    </div>
                                                                    <small class="text-muted">Status Server</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="text-center p-2 bg-light rounded">
                                                                    <div class="text-info fw-bold">
                                                                        <i class="bi bi-database-fill"></i> Aktif
                                                                    </div>
                                                                    <small class="text-muted">Database</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row g-2 mt-2">
                                                            <div class="col-6">
                                                                <div class="text-center p-2 bg-light rounded">
                                                                    <div class="text-warning fw-bold">
                                                                        <i class="bi bi-shield-fill"></i> Aman
                                                                    </div>
                                                                    <small class="text-muted">Keamanan</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="text-center p-2 bg-light rounded">
                                                                    <div class="text-primary fw-bold">
                                                                        <i class="bi bi-clock-fill"></i> 24/7
                                                                    </div>
                                                                    <small class="text-muted">Uptime</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-info mb-2">
                                                            <i class="bi bi-calendar-event me-2"></i>Informasi Pengembangan
                                                        </h6>
                                                        <ul class="text-muted mb-0" style="list-style: none; padding-left: 0;">
                                                            <li><i class="bi bi-calendar-check text-info me-2"></i>Dikembangkan oleh: <span class="text-dark">Tim IT UNJAYA</span></li>
                                                            <li><i class="bi bi-calendar-check text-info me-2"></i>Framework: <span class="text-dark">Python Flask</span></li>
                                                            <li><i class="bi bi-calendar-check text-info me-2"></i>Database: <span class="text-dark">MySQL</span></li>
                                                            <li><i class="bi bi-calendar-check text-info me-2"></i>Frontend: <span class="text-dark">Bootstrap 5</span></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-secondary mb-2">
                                                            <i class="bi bi-cpu me-2"></i>Fitur Teknis
                                                        </h6>
                                                        <ul class="text-muted mb-0" style="list-style: none; padding-left: 0;">
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Multi-user authentication</li>
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Role-based access control</li>
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>File upload & management</li>
                                                            <li><i class="bi bi-check-circle text-secondary me-2"></i>Real-time data processing</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-warning mb-2">
                                                            <i class="bi bi-shield-lock me-2"></i>Keamanan Sistem
                                                        </h6>
                                                        <ul class="text-muted mb-0" style="list-style: none; padding-left: 0;">
                                                            <li><i class="bi bi-check-circle text-warning me-2"></i>Session management</li>
                                                            <li><i class="bi bi-check-circle text-warning me-2"></i>Password hashing</li>
                                                            <li><i class="bi bi-check-circle text-warning me-2"></i>Input validation</li>
                                                            <li><i class="bi bi-check-circle text-warning me-2"></i>Activity logging</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-danger mb-2">
                                                            <i class="bi bi-file-earmark-text me-2"></i>Lisensi & Copyright
                                                        </h6>
                                                        <p class="text-muted mb-0">
                                                            <strong>Â© 2025 Universitas Jenderal Achmad Yani Yogyakarta</strong><br>
                                                            <small class="text-info">Semua hak cipta dilindungi. Sistem AYMP UNJAYA adalah properti eksklusif UNJAYA.</small>
                                                        </p>
                                                        <div class="mt-2">
                                                            <small class="text-muted">
                                                                <i class="bi bi-info-circle me-1"></i>
                                                                Penggunaan sistem tunduk pada kebijakan dan ketentuan UNJAYA
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item mb-3">
                                                        <h6 class="text-primary mb-2">
                                                            <i class="bi bi-gear-wide-connected me-2"></i>Fitur File & Export
                                                        </h6>
                                                        <ul class="text-muted mb-0" style="list-style: none; padding-left: 0;">
                                                            <li><i class="bi bi-check-circle text-primary me-2"></i>Upload: PDF</li>
                                                            <li><i class="bi bi-check-circle text-primary me-2"></i>Export: Excel, PDF, Word</li>
                                                            <li><i class="bi bi-check-circle text-primary me-2"></i>File validation</li>
                                                            <li><i class="bi bi-check-circle text-primary me-2"></i>Secure file storage</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                             <!-- Tab Pengaturan Anggaran -->
                             <div class="tab-pane fade" id="pengaturan-anggaran" role="tabpanel">
                                <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                <i class="bi bi-cash-coin me-2"></i>Pengaturan Total Anggaran
                                            </h5>
                                            <p class="text-muted mb-0">Atur batas minimal dan maksimal total anggaran untuk Anggaran Awal dan Anggaran Bertumbuh. Nilai 0 berarti tidak dibatasi.</p>
                                        </div>
                                    </div>
                                    <form id="formPengaturanAnggaran">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                    <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                        <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                            <i class="bi bi-1-square me-2"></i>Anggaran Awal
                                                        </h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="mb-3">
                                                            <label for="min_total_awal" class="form-label">Minimal Total Anggaran (Rp)</label>
                                                            <input type="number" class="form-control" id="min_total_awal" name="min_total_awal" min="0" value="0">
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="max_total_awal" class="form-label">Maksimal Total Anggaran (Rp)</label>
                                                            <input type="number" class="form-control" id="max_total_awal" name="max_total_awal" min="0" value="0">
                                                            <small class="text-muted">Isi 0 jika tidak ingin membatasi maksimal.</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                    <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                        <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                            <i class="bi bi-2-square me-2"></i>Anggaran Bertumbuh
                                                        </h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="mb-3">
                                                            <label for="min_total_bertumbuh" class="form-label">Minimal Total Anggaran (Rp)</label>
                                                            <input type="number" class="form-control" id="min_total_bertumbuh" name="min_total_bertumbuh" min="0" value="0">
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="max_total_bertumbuh" class="form-label">Maksimal Total Anggaran (Rp)</label>
                                                            <input type="number" class="form-control" id="max_total_bertumbuh" name="max_total_bertumbuh" min="0" value="0">
                                                            <small class="text-muted">Isi 0 jika tidak ingin membatasi maksimal.</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-save me-2"></i>Simpan Pengaturan Anggaran
                                            </button>
                                        </div>
                                    </form>
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <div class="alert alert-info" style="border-radius: 12px;">
                                                <h6 class="alert-heading">
                                                    <i class="bi bi-info-circle me-2"></i>Catatan
                                                </h6>
                                                <p class="mb-0">
                                                    Batas ini akan divalidasi saat mahasiswa menekan tombol kirim proposal. Jika total anggaran tidak memenuhi batas minimal atau melebihi batas maksimal, pengiriman akan ditolak.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

                                    <!-- Tab Program Studi -->
                                    <div class="tab-pane fade" id="program-studi" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-mortarboard me-2"></i>Program Studi
                                                    </h5>
                                                    <p class="text-muted mb-0">Kelola data program studi yang tersedia di sistem</p>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-primary btn-rounded-pill" data-bs-toggle="modal" data-bs-target="#modalTambahProgramStudi">
                                                        <i class="bi bi-plus-circle me-2"></i>Tambah Program Studi
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table table-hover" id="tableProgramStudi">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Nama Program Studi</th>
                                                            <th>Tanggal Dibuat</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for program in program_studi_list %}
                                                        <tr>
                                                            <td>{{ loop.index }}</td>
                                                            <td>{{ program.nama_program_studi }}</td>
                                                            <td>{{ program.created_at.strftime('%d/%m/%Y %H:%M') if program.created_at else '-' }}</td>
                                                            <td>
                                                                <button type="button" class="btn btn-sm btn-warning me-1 btn-rounded-circle" 
                                                                        onclick="editProgramStudi({{ program.id }}, '{{ program.nama_program_studi }}')"
                                                                        title="Edit"
                                                                        style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">
                                                                    <i class="bi bi-pencil" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>
                                                                </button>
                                                                <button type="button" class="btn btn-sm btn-danger btn-rounded-circle" 
                                                                        onclick="deleteProgramStudi({{ program.id }}, '{{ program.nama_program_studi }}')"
                                                                        title="Hapus"
                                                                        style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">
                                                                    <i class="bi bi-trash" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab Penilaian Mahasiswa -->
                                    <div class="tab-pane fade" id="penilaian-mahasiswa" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-person-check me-2"></i>Penilaian Mahasiswa
                                                    </h5>
                                                    <p class="text-muted mb-0">Kelola pertanyaan penilaian untuk pembimbing menilai mahasiswa</p>
                                                </div>
                                                <div>
                                                <div class="dropdown">
                                                        <button class="btn btn-primary btn-rounded-pill dropdown-toggle" type="button" id="dropdownTambahPertanyaan" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan
                                                    </button>
                                                        <ul class="dropdown-menu" aria-labelledby="dropdownTambahPertanyaan">
                                                            <li><a class="dropdown-item" href="#" data-kategori="pondasi-bisnis" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Pondasi Bisnis (Business Foundation)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="pelanggan" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Pelanggan (Customers)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="produk-jasa" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Produk/Jasa (Product/Service)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="pemasaran" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Pemasaran (Marketing)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="penjualan" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Penjualan (Sales)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="keuntungan" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                               Keuntungan (Profit)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="sdm" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Sumber Daya Manusia (Human Resources)
                                                        </a></li>
                                                            <li><a class="dropdown-item" href="#" data-kategori="sistem-bisnis" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanMahasiswa">
                                                                Sistem Bisnis (Business System)
                                                        </a></li>
                                                    </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table table-hover" id="tablePertanyaanMahasiswa">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Kategori</th>
                                                            <th>Pertanyaan</th>
                                                            <th>Bobot (SKS)</th>
                                                            <th>Skor Maksimal</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Data akan diisi melalui AJAX -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab Penilaian Proposal -->
                                    <div class="tab-pane fade" id="penilaian-proposal" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-file-earmark-text me-2"></i>Penilaian Proposal
                                                    </h5>
                                                    <p class="text-muted mb-0">Kelola pertanyaan penilaian untuk reviewer menilai proposal mahasiswa</p>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-primary btn-rounded-pill" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanProposal">
                                                        <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table table-hover" id="tablePertanyaanProposal">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Pertanyaan</th>
                                                            <th>Bobot (SKS)</th>
                                                            <th>Skor Maksimal</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Data akan diisi melalui AJAX -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab Penilaian Laporan Kemajuan -->
                                    <div class="tab-pane fade" id="penilaian-laporan-kemajuan" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-graph-up me-2"></i>Penilaian Laporan Kemajuan
                                                    </h5>
                                                    <p class="text-muted mb-0">Kelola pertanyaan penilaian untuk reviewer menilai laporan kemajuan mahasiswa</p>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-primary btn-rounded-pill" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanLaporanKemajuan">
                                                        <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan
                                                                </button>
                                                </div>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table table-hover" id="tablePertanyaanLaporanKemajuan">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Pertanyaan</th>
                                                            <th>Bobot (SKS)</th>
                                                            <th>Skor Maksimal</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Data akan diisi melalui AJAX -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab Penilaian Laporan Akhir -->
                                    <div class="tab-pane fade" id="penilaian-laporan-akhir" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-clipboard-data me-2"></i>Penilaian Laporan Akhir
                                                    </h5>
                                                    <p class="text-muted mb-0">Kelola pertanyaan penilaian untuk reviewer menilai laporan akhir mahasiswa</p>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-primary btn-rounded-pill" data-bs-toggle="modal" data-bs-target="#modalTambahPertanyaanLaporanAkhir">
                                                        <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan
                                                                </button>
                                                </div>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table table-hover" id="tablePertanyaanLaporanAkhir">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Pertanyaan</th>
                                                            <th>Bobot (SKS)</th>
                                                            <th>Skor Maksimal</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Data akan diisi melalui AJAX -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab Pengaturan Default -->
                                    <div class="tab-pane fade" id="pengaturan-default" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-gear me-2"></i>Pengaturan Default Skor Maksimal
                                                    </h5>
                                                    <p class="text-muted mb-0">Atur skor maksimal default untuk setiap jenis penilaian</p>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                            <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                                <i class="bi bi-person-check me-2"></i>Penilaian Mahasiswa
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="formDefaultMahasiswa">
                                                                <div class="mb-3">
                                                                    <label for="default_skor_mahasiswa" class="form-label">Skor Maksimal Default</label>
                                                                    <input type="number" class="form-control" id="default_skor_mahasiswa" name="default_skor" min="1" max="100" value="100" required>
                                                                    <small class="text-muted">Skor maksimal yang akan otomatis terisi saat menambah pertanyaan baru</small>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary btn-sm">
                                                                    <i class="bi bi-save me-1"></i>Simpan
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                            <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                                <i class="bi bi-file-earmark-text me-2"></i>Penilaian Proposal
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="formDefaultProposal">
                                                                <div class="mb-3">
                                                                    <label for="default_skor_proposal" class="form-label">Skor Maksimal Default</label>
                                                                    <input type="number" class="form-control" id="default_skor_proposal" name="default_skor" min="1" max="100" value="100" required>
                                                                    <small class="text-muted">Skor maksimal yang akan otomatis terisi saat menambah pertanyaan baru</small>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary btn-sm">
                                                                    <i class="bi bi-save me-1"></i>Simpan
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                            <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                                <i class="bi bi-graph-up me-2"></i>Penilaian Laporan Kemajuan
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="formDefaultLaporanKemajuan">
                                                                <div class="mb-3">
                                                                    <label for="default_skor_laporan_kemajuan" class="form-label">Skor Maksimal Default</label>
                                                                    <input type="number" class="form-control" id="default_skor_laporan_kemajuan" name="default_skor" min="1" max="100" value="100" required>
                                                                    <small class="text-muted">Skor maksimal yang akan otomatis terisi saat menambah pertanyaan baru</small>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary btn-sm">
                                                                    <i class="bi bi-save me-1"></i>Simpan
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                            <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                                <i class="bi bi-clipboard-data me-2"></i>Penilaian Laporan Akhir
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="formDefaultLaporanAkhir">
                                                                <div class="mb-3">
                                                                    <label for="default_skor_laporan_akhir" class="form-label">Skor Maksimal Default</label>
                                                                    <input type="number" class="form-control" id="default_skor_laporan_akhir" name="default_skor" min="1" max="100" value="100" required>
                                                                    <small class="text-muted">Skor maksimal yang akan otomatis terisi saat menambah pertanyaan baru</small>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary btn-sm">
                                                                    <i class="bi bi-save me-1"></i>Simpan
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                            <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                                <i class="bi bi-people me-2"></i>Kuota Mahasiswa Pembimbing
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="formDefaultKuotaMahasiswa">
                                                                <div class="mb-3">
                                                                    <label for="default_kuota_mahasiswa" class="form-label">Kuota Mahasiswa Default</label>
                                                                    <input type="number" class="form-control" id="default_kuota_mahasiswa" name="default_kuota" min="1" max="50" value="5" required>
                                                                    <small class="text-muted">Jumlah mahasiswa maksimal yang bisa dibimbing oleh satu pembimbing</small>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary btn-sm">
                                                                    <i class="bi bi-save me-1"></i>Simpan
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 12px;">
                                                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0;">
                                                            <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                                <i class="bi bi-person-check me-2"></i>Kuota Review Reviewer
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="formDefaultKuotaReview">
                                                                <div class="mb-3">
                                                                    <label for="default_kuota_review" class="form-label">Kuota Review Default</label>
                                                                    <input type="number" class="form-control" id="default_kuota_review" name="default_kuota" min="0" max="100" value="0" required>
                                                                    <small class="text-muted">Jumlah proposal maksimal yang bisa direview oleh satu reviewer</small>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary btn-sm">
                                                                    <i class="bi bi-save me-1"></i>Simpan
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row mt-4">
                                                <div class="col-12">
                                                    <div class="alert alert-info" style="border-radius: 12px;">
                                                        <h6 class="alert-heading">
                                                            <i class="bi bi-info-circle me-2"></i>Informasi Pengaturan Default
                                                        </h6>
                                                        <p class="mb-0">
                                                            Pengaturan ini akan menentukan nilai default untuk field "Skor Maksimal" saat admin menambah pertanyaan baru, "Kuota Mahasiswa" saat admin menambah pembimbing baru, dan "Kuota Review" saat admin menambah reviewer baru. 
                                                            Admin masih bisa mengubah nilai ini secara manual saat menambah atau mengedit data.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab Pengaturan Jadwal Penilaian -->
                                    <div class="tab-pane fade" id="pengaturan-jadwal-penilaian" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-calendar2-check me-2"></i>Pengaturan Jadwal Penilaian (Pembimbing & Reviewer)
                                                    </h5>
                                                    <p class="text-muted mb-0">Atur jadwal mulai/selesai untuk proses penilaian Pembimbing dan Reviewer.</p>
                                                </div>
                                            </div>

                                            <form id="formPengaturanJadwalPenilaian">
                                                <div class="schedule-section mb-3 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-person-check me-2"></i>Pembimbing Menilai Mahasiswa</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedulePenilaian('pembimbing')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="pembimbing_nilai_mulai" name="pembimbing_nilai_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="pembimbing_nilai_selesai" name="pembimbing_nilai_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>

                                                    <!-- Pengaturan Interval Penilaian -->
                                                    <div class="mt-3 p-3" style="background-color: #f8f9fa; border-radius: 8px;">
                                                        <h6 class="mb-3" style="color: #495057;"><i class="bi bi-clock me-2"></i>Pengaturan Interval Penilaian</h6>
                                                        
                                                        <div class="alert alert-info mb-3" id="single_day_info" style="display: none;">
                                                            <i class="bi bi-info-circle me-2"></i>
                                                            <strong>Mode 1 Hari:</strong> Pengaturan disederhanakan karena range tanggal sama (hanya 1 hari).
                                                        </div>
                                                        
                                                        <div class="row g-3" id="interval_controls">
                                                            <div class="col-md-4">
                                                                <label class="form-label">Tipe Interval</label>
                                                                <select class="form-select" id="pembimbing_interval_tipe" name="pembimbing_interval_tipe">
                                                                    <option value="harian">Harian</option>
                                                                    <option value="mingguan">Mingguan</option>
                                                                    <option value="bulanan">Bulanan</option>
                                                                    <option value="setiap_jam">Setiap Jam</option>
                                                                </select>
                                                            </div>
                                                                                                                          <div class="col-md-4" id="interval_nilai_container">
                                                                  <label class="form-label">Setiap Berapa</label>
                                                                  <input type="number" class="form-control" id="pembimbing_interval_nilai" name="pembimbing_interval_nilai" value="" min="1" max="30" placeholder="1">
                                                                  <small class="text-muted">Contoh: 2 = setiap 2 hari/minggu/bulan</small>
                                                              </div>
                                                              <div class="col-md-4" id="hari_aktif_container">
                                                                  <label class="form-label">Hari Aktif</label>
                                                                  <input type="text" class="form-control" id="pembimbing_hari_aktif" name="pembimbing_hari_aktif" value="" placeholder="1,2,3,4,5">
                                                                  <small class="text-muted">1=Sen, 2=Sel, 3=Rab, 4=Kam, 5=Jum, 6=Sab, 7=Min</small>
                                                              </div>
                                                        </div>

                                                        

                                                        <div class="mt-3">
                                                            <div class="alert alert-info mb-0">
                                                                <h6 class="alert-heading mb-2">ð Contoh Pengaturan:</h6>
                                                                <ul class="mb-0">
                                                                    <li><strong>Mode 1 Hari:</strong> Range: 14/8/2025 08:00 - 14/8/2025 17:00 â Otomatis "Setiap Jam", controls disederhanakan</li>
                                                                    <li><strong>Mode 2 Hari:</strong> Range: 15/8/2025 - 16/8/2025 â Otomatis harian, hari aktif terdeteksi (misal: Kamis & Jumat)</li>
                                                                    <li><strong>Mode Multi-Hari:</strong> Range: 14/8/2025 - 20/8/2025 â Tipe = Harian/Mingguan/Bulanan, semua controls aktif</li>
                                                                    <li><strong>Penilaian Mingguan:</strong> Range: 14/8/2025 - 14/1/2026 â Tipe = Mingguan, Setiap = 2, Hari Aktif = 1</li>
                                                                    <li><strong>Penilaian Bulanan:</strong> Range: 14/8/2025 - 14/1/2026 â Tipe = Bulanan, pembimbing nilai 1x/bulan</li>
                                                                </ul>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="schedule-section mb-3 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-file-earmark-text me-2"></i>Reviewer Menilai Proposal</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedulePenilaian('reviewer_proposal')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="reviewer_proposal_mulai" name="reviewer_proposal_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="reviewer_proposal_selesai" name="reviewer_proposal_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="schedule-section mb-3 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-graph-up me-2"></i>Reviewer Menilai Laporan Kemajuan</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedulePenilaian('reviewer_kemajuan')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="reviewer_kemajuan_mulai" name="reviewer_kemajuan_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="reviewer_kemajuan_selesai" name="reviewer_kemajuan_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="schedule-section mb-4 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-clipboard-check me-2"></i>Reviewer Menilai Laporan Akhir</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedulePenilaian('reviewer_akhir')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="reviewer_akhir_mulai" name="reviewer_akhir_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="reviewer_akhir_selesai" name="reviewer_akhir_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="d-flex gap-2">
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="bi bi-save me-2"></i>Simpan Jadwal Penilaian
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary" onclick="clearSchedulePenilaian('all')">
                                                        <i class="bi bi-eraser me-2"></i>Kosongkan Semua
                                                    </button>
                                                    <button type="button" class="btn btn-info" onclick="debugMetadata()">
                                                        <i class="bi bi-bug me-2"></i>Debug Metadata
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <!-- Tab Pengaturan Bimbingan -->
                                    <div class="tab-pane fade" id="pengaturan-bimbingan" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-chat-dots me-2"></i>Pengaturan Bimbingan Mahasiswa
                                                    </h5>
                                                    <p class="text-muted mb-0">Atur batasan dan ketentuan bimbingan mahasiswa</p>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    <form id="formPengaturanBimbingan">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="mb-3">
                                                                    <label for="maksimal_bimbingan_per_hari" class="form-label">
                                                                        <i class="bi bi-calendar-check me-2"></i>Maksimal Bimbingan per Hari
                                                                    </label>
                                                                    <input type="number" class="form-control" id="maksimal_bimbingan_per_hari" 
                                                                           name="maksimal_bimbingan_per_hari" min="1" max="10" value="3" required>
                                                                    <div class="form-text">Jumlah maksimal bimbingan yang dapat dilakukan mahasiswa dalam satu hari (1-10)</div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="mb-3">
                                                                    <label class="form-label">
                                                                        <i class="bi bi-toggle-on me-2"></i>Status Pengaturan
                                                                    </label>
                                                                    <div class="form-check form-switch">
                                                                        <input class="form-check-input" type="checkbox" id="status_aktif_switch">
                                                                        <label class="form-check-label" for="status_aktif_switch">
                                                                            <span id="status_aktif_label" class="badge bg-success">Aktif</span>
                                                                        </label>
                                                                    </div>
                                                                    <div class="form-text">Geser tombol untuk mengaktifkan atau menonaktifkan batasan bimbingan</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="mb-3">
                                                                    <label class="form-label">
                                                                        <i class="bi bi-chat-text me-2"></i>Pratinjau Pesan Batasan (Otomatis)
                                                                    </label>
                                                                    <div id="preview_pesan_batasan" class="form-control-plaintext" style="background:#f8f9fa;border:1px solid #dee2e6;border-radius:0.375rem;padding:0.75rem;">
                                                                        Anda telah mencapai batas maksimal bimbingan hari ini. Maksimal 3 kali per hari. Silakan coba lagi besok.
                                                                    </div>
                                                                    <div class="form-text">Pesan ini dihasilkan otomatis berdasarkan nilai "Maksimal Bimbingan per Hari".</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <button type="submit" class="btn btn-primary" style="border-radius: 8px; padding: 12px 24px; font-weight: 600;">
                                                                    <i class="bi bi-save me-2"></i>Simpan Pengaturan Bimbingan
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>

                                            <div class="row mt-4">
                                                <div class="col-12">
                                                    <div class="alert alert-info" style="border-radius: 12px;">
                                                        <h6 class="alert-heading">
                                                            <i class="bi bi-info-circle me-2"></i>Informasi Pengaturan Bimbingan
                                                        </h6>
                                                        <p class="mb-0">
                                                            Pengaturan ini akan membatasi jumlah bimbingan yang dapat dilakukan mahasiswa per hari. 
                                                            Jika status diatur "Aktif", mahasiswa hanya dapat menyimpan hasil bimbingan sesuai batas yang ditentukan. 
                                                            Jika status "Nonaktif", mahasiswa dapat melakukan bimbingan tanpa batasan.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Tab Pengaturan Jadwal -->
                                    <div class="tab-pane fade" id="pengaturan-jadwal" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-calendar-event me-2"></i>Pengaturan Jadwal
                                                    </h5>
                                                    <p class="text-muted mb-0">Atur jadwal mulai dan selesai untuk Proposal, Laporan Kemajuan, dan Laporan Akhir</p>
                                     </div>
                                            </div>

                                            <form id="formPengaturanJadwal">
                                                <div class="schedule-section mb-3 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-file-earmark-text me-2"></i>Jadwal Proposal</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedule('proposal')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="proposal_mulai" name="proposal_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="proposal_selesai" name="proposal_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="schedule-section mb-3 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-clipboard-data me-2"></i>Jadwal Laporan Kemajuan</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedule('kemajuan')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="kemajuan_mulai" name="kemajuan_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="kemajuan_selesai" name="kemajuan_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="schedule-section mb-4 p-3" style="border:1px solid #e9ecef;border-radius:12px;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0" style="font-weight:700;color:#25396f;"><i class="bi bi-clipboard-check me-2"></i>Jadwal Laporan Akhir</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSchedule('akhir')"><i class="bi bi-arrow-counterclockwise me-1"></i>Reset</button>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mulai</label>
                                                            <input type="text" class="form-control" id="akhir_mulai" name="akhir_mulai" placeholder="Pilih tanggal & waktu mulai">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Selesai</label>
                                                            <input type="text" class="form-control" id="akhir_selesai" name="akhir_selesai" placeholder="Pilih tanggal & waktu selesai">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="d-flex gap-2">
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="bi bi-save me-2"></i>Simpan Pengaturan Jadwal
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary" onclick="clearSchedule('all')">
                                                        <i class="bi bi-eraser me-2"></i>Kosongkan Semua
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <!-- Tab Pengaturan Auto-fill -->
                                    <div class="tab-pane fade" id="pengaturan-auto-fill" role="tabpanel">
                                        <div class="card" style="border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:24px 18px 10px 18px;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 style="font-weight:700;font-size:1.25rem;color:#435ebe;">
                                                        <i class="bi bi-gear-wide-connected me-2"></i>Pengaturan Auto-fill Worker
                                                    </h5>
                                                    <p class="text-muted mb-0">Kelola auto-fill worker untuk mengisi sesi terlewat secara otomatis</p>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="card border-0 bg-light" style="border-radius:12px;">
                                                        <div class="card-body">
                                                            <h6 class="card-title mb-3">
                                                                <i class="bi bi-play-circle me-2"></i>Status Worker
                                                            </h6>
                                                            <div id="worker-status-container">
                                                                <div class="d-flex align-items-center mb-3">
                                                                    <div class="spinner-border spinner-border-sm me-2" role="status" id="status-spinner">
                                                                        <span class="visually-hidden">Loading...</span>
                                                                    </div>
                                                                    <span id="worker-status-text">Mengecek status...</span>
                                                                </div>
                                                                <div class="d-flex gap-2">
                                                                    <button type="button" class="btn btn-success btn-sm" id="start-worker-btn" onclick="startAutoFillWorker()">
                                                                        <i class="bi bi-play-fill me-1"></i>Mulai Worker
                                                                    </button>
                                                                    <button type="button" class="btn btn-danger btn-sm" id="stop-worker-btn" onclick="stopAutoFillWorker()">
                                                                        <i class="bi bi-stop-fill me-1"></i>Hentikan Worker
                                                                    </button>
                                                                    <button type="button" class="btn btn-primary btn-sm" onclick="runAutoFillOnce()">
                                                                        <i class="bi bi-arrow-clockwise me-1"></i>Jalankan Sekali
                                                                    </button>
                                                                    <button type="button" class="btn btn-warning btn-sm" onclick="runAutoRejectOnce()">
                                                                        <i class="bi bi-x-circle me-1"></i>Auto-Reject
                                                                    </button>
                                                                    <button type="button" class="btn btn-danger btn-sm" onclick="cleanupIncorrectAutoFill()">
                                                                        <i class="bi bi-trash me-1"></i>Cleanup Data Salah
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="card border-0 bg-light" style="border-radius:12px;">
                                                        <div class="card-body">
                                                            <h6 class="card-title mb-3">
                                                                <i class="bi bi-info-circle me-2"></i>Informasi Worker
                                                            </h6>
                                                            <div class="small">
                                                                <p class="mb-2"><strong>Interval Pengecekan:</strong> 60 detik</p>
                                                                <p class="mb-2"><strong>Pengecekan Prioritas:</strong> 30 detik</p>
                                                                <p class="mb-2"><strong>Batch Size:</strong> 10 jadwal</p>
                                                                <p class="mb-0"><strong>Status:</strong> <span id="worker-info-status">-</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mt-4">
                                                <div class="alert alert-info mb-0">
                                                    <h6 class="alert-heading mb-2">ð Cara Kerja Auto-fill Worker:</h6>
                                                    <ul class="mb-0">
                                                        <li><strong>Otomatis:</strong> Worker berjalan di background setiap 1 menit</li>
                                                        <li><strong>Deteksi Sesi:</strong> Mendeteksi sesi penilaian yang terlewat</li>
                                                        <li><strong>Auto-fill:</strong> Mengisi sesi terlewat dengan skor 0</li>
                                                        <li><strong>Smart Stop:</strong> Berhenti otomatis jika semua sesi sudah terisi</li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <div class="mt-3">
                                                <div class="alert alert-warning mb-0">
                                                    <h6 class="alert-heading mb-2">ð« Cara Kerja Auto-Reject Worker:</h6>
                                                    <ul class="mb-0">
                                                        <li><strong>Anggaran:</strong> Otomatis menolak anggaran jika melewati jadwal proposal_selesai</li>
                                                        <li><strong>Laporan Kemajuan:</strong> Otomatis menolak laporan kemajuan jika melewati jadwal kemajuan_selesai</li>
                                                        <li><strong>Laporan Akhir:</strong> Otomatis menolak laporan akhir jika melewati jadwal akhir_selesai</li>
                                                        <li><strong>Status:</strong> Mengubah status dari 'draf', 'diajukan', 'revisi' menjadi 'ditolak'</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Basic Tables end -->

                <!-- Modal Tambah Program Studi -->
                <div class="modal fade" id="modalTambahProgramStudi" tabindex="-1" aria-labelledby="modalTambahProgramStudiLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalTambahProgramStudiLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-plus-circle me-2"></i>Tambah Program Studi
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formTambahProgramStudi">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <div class="mb-3">
                                        <label for="nama_program_studi" class="form-label">Nama Program Studi <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="nama_program_studi" name="nama_program_studi" required>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-primary btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Simpan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Edit Program Studi -->
                <div class="modal fade" id="modalEditProgramStudi" tabindex="-1" aria-labelledby="modalEditProgramStudiLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalEditProgramStudiLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-pencil me-2"></i>Edit Program Studi
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formEditProgramStudi">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <input type="hidden" id="edit_program_studi_id" name="program_studi_id">
                                    <div class="mb-3">
                                        <label for="edit_nama_program_studi" class="form-label">Nama Program Studi <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="edit_nama_program_studi" name="nama_program_studi" required>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-warning btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Update
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Tambah Pertanyaan Penilaian Mahasiswa -->
                <div class="modal fade" id="modalTambahPertanyaanMahasiswa" tabindex="-1" aria-labelledby="modalTambahPertanyaanMahasiswaLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalTambahPertanyaanMahasiswaLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan Penilaian Mahasiswa
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formTambahPertanyaanMahasiswa">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <!-- Kategori yang dipilih -->
                                    <div class="row mb-3">
                                        <div class="col-md-12">
                                            <div class="alert alert-info" role="alert">
                                                <i class="bi bi-info-circle me-2"></i>
                                                <strong>Kategori:</strong> <span id="kategoriDipilih">-</span>
                                                <input type="hidden" id="kategori_mahasiswa" name="kategori">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Form Pertanyaan Dinamis -->
                                    <div id="formPertanyaanDinamis">
                                        <!-- Form pertama -->
                                        <div class="pertanyaan-form mb-4" data-index="0">
                                            <div class="card" style="border: 1px solid #e9ecef; border-radius: 8px;">
                                                <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; padding: 0.75rem 1rem;">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                                            <i class="bi bi-list-ol me-2"></i>Pertanyaan #1
                                                        </h6>
                                                        <button type="button" class="btn btn-sm btn-outline-danger hapus-pertanyaan" data-index="0" style="display: none;">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-12 mb-3">
                                                                <label class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                            <textarea class="form-control pertanyaan-input" name="pertanyaan[]" rows="2" required placeholder="Masukkan pertanyaan penilaian..."></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                                <label class="form-label">Bobot <span class="text-danger">*</span></label>
                                                            <input type="number" class="form-control bobot-input" name="bobot[]" min="1" max="100" required placeholder="Contoh: 25">
                                                            <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                                            </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Skor Maksimal</label>
                                                            <div class="form-control-plaintext" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.375rem 0.75rem;">
                                                                <span class="skor-default-value">100</span>
                                                                <small class="text-muted ms-2">(Default dari pengaturan)</small>
                                                        </div>
                                                            <input type="hidden" class="skor-input" name="skor[]" value="100">
                                                            <small class="text-muted">Skor tertinggi yang bisa diberikan pembimbing</small>
                                                                </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Status <span class="text-danger">*</span></label>
                                                            <select class="form-select status-input" name="status[]" required>
                                                                <option value="Aktif">Aktif</option>
                                                                <option value="Nonaktif">Nonaktif</option>
                                                            </select>
                                                            <small class="text-muted">Status pertanyaan penilaian</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tombol Tambah Pertanyaan -->
                                    <div class="text-center mb-3">
                                        <button type="button" class="btn btn-outline-primary btn-sm" id="tambahPertanyaanBtn">
                                            <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan
                                        </button>
                                    </div>
                                    

                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-primary btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Simpan Semua Pertanyaan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Edit Pertanyaan Penilaian Mahasiswa -->
                <div class="modal fade" id="modalEditPertanyaanMahasiswa" tabindex="-1" aria-labelledby="modalEditPertanyaanMahasiswaLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalEditPertanyaanMahasiswaLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-pencil me-2"></i>Edit Pertanyaan Penilaian Mahasiswa
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formEditPertanyaanMahasiswa">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <input type="hidden" id="edit_pertanyaan_mahasiswa_id" name="pertanyaan_id">
                                    
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="edit_kategori_mahasiswa" class="form-label">Kategori <span class="text-danger">*</span></label>
                                                <select class="form-select" id="edit_kategori_mahasiswa" name="kategori" required>
                                                    <option value="pondasi-bisnis">Pondasi Bisnis (Business Foundation)</option>
                                                    <option value="pelanggan">Pelanggan (Customers)</option>
                                                    <option value="produk-jasa">Produk/Jasa (Product/Service)</option>
                                                    <option value="pemasaran">Pemasaran (Marketing)</option>
                                                    <option value="penjualan">Penjualan (Sales)</option>
                                                    <option value="keuntungan">Keuntungan (Profit)</option>
                                                    <option value="sdm">Sumber Daya Manusia (Human Resources)</option>
                                                    <option value="sistem-bisnis">Sistem Bisnis (Business System)</option>
                                                </select>
                                                <small class="text-muted">Kategori penilaian mahasiswa</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                                                        <div class="row">
                                        <div class="col-md-12">
                                    <div class="mb-3">
                                                <label for="edit_pertanyaan_mahasiswa" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="edit_pertanyaan_mahasiswa" name="pertanyaan" rows="3" required></textarea>
                                    </div>
                                        </div>
                                    </div>
                                                                        <div class="row">
                                        <div class="col-md-6">
                                                                                <div class="mb-3">
                                                <label for="edit_bobot_mahasiswa" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_bobot_mahasiswa" name="bobot" min="1" max="100" required>
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                    <div class="mb-3">
                                                <label for="edit_skor_mahasiswa" class="form-label">Skor Maksimal <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_skor_mahasiswa" name="skor" min="1" max="100" required>
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan pembimbing</small>
                                    </div>
                                        </div>
                                    </div>
                                                                        <div class="row">
                                        <div class="col-md-6">
                                    <div class="mb-3">
                                                <label for="edit_status_mahasiswa" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="edit_status_mahasiswa" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-warning btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Update
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Tambah Pertanyaan Penilaian Proposal -->
                <div class="modal fade" id="modalTambahPertanyaanProposal" tabindex="-1" aria-labelledby="modalTambahPertanyaanProposalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalTambahPertanyaanProposalLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan Penilaian Proposal
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formTambahPertanyaanProposal">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="pertanyaan_proposal" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="pertanyaan_proposal" name="pertanyaan" rows="3" required placeholder="Masukkan pertanyaan penilaian untuk reviewer..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="bobot_proposal" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="bobot_proposal" name="bobot" min="1" max="100" required placeholder="Contoh: 25">
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Skor Maksimal</label>
                                                <div class="form-control-plaintext" id="skor_proposal_display" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.375rem 0.75rem;">
                                                    <span id="skor_proposal_value">100</span>
                                                    <small class="text-muted ms-2">(Default dari pengaturan)</small>
                                                </div>
                                                <input type="hidden" id="skor_proposal" name="skor" value="100">
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan reviewer</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="status_proposal" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="status_proposal" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-primary btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Simpan
                                    </button>
                                </div>
                            </form>
                    </div>
                </div>
            </div>

                <!-- Modal Edit Pertanyaan Penilaian Proposal -->
                <div class="modal fade" id="modalEditPertanyaanProposal" tabindex="-1" aria-labelledby="modalEditPertanyaanProposalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalEditPertanyaanProposalLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-pencil me-2"></i>Edit Pertanyaan Penilaian Proposal
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formEditPertanyaanProposal">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <input type="hidden" id="edit_pertanyaan_proposal_id" name="pertanyaan_id">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="edit_pertanyaan_proposal" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="edit_pertanyaan_proposal" name="pertanyaan" rows="3" required></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_bobot_proposal" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_bobot_proposal" name="bobot" min="1" max="100" required>
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_skor_proposal" class="form-label">Skor Maksimal <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_skor_proposal" name="skor" min="1" max="100" required>
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan reviewer</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_status_proposal" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="edit_status_proposal" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-warning btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Update
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Tambah Pertanyaan Penilaian Laporan Kemajuan -->
                <div class="modal fade" id="modalTambahPertanyaanLaporanKemajuan" tabindex="-1" aria-labelledby="modalTambahPertanyaanLaporanKemajuanLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalTambahPertanyaanLaporanKemajuanLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan Penilaian Laporan Kemajuan
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formTambahPertanyaanLaporanKemajuan">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="pertanyaan_laporan_kemajuan" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="pertanyaan_laporan_kemajuan" name="pertanyaan" rows="3" required placeholder="Masukkan pertanyaan penilaian untuk reviewer..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="bobot_laporan_kemajuan" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="bobot_laporan_kemajuan" name="bobot" min="1" max="100" required placeholder="Contoh: 25">
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Skor Maksimal</label>
                                                <div class="form-control-plaintext" id="skor_laporan_kemajuan_display" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.375rem 0.75rem;">
                                                    <span id="skor_laporan_kemajuan_value">100</span>
                                                    <small class="text-muted ms-2">(Default dari pengaturan)</small>
                                                </div>
                                                <input type="hidden" id="skor_laporan_kemajuan" name="skor" value="100">
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan reviewer</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="status_laporan_kemajuan" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="status_laporan_kemajuan" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-primary btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Simpan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Edit Pertanyaan Penilaian Laporan Kemajuan -->
                <div class="modal fade" id="modalEditPertanyaanLaporanKemajuan" tabindex="-1" aria-labelledby="modalEditPertanyaanLaporanKemajuanLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalEditPertanyaanLaporanKemajuanLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-pencil me-2"></i>Edit Pertanyaan Penilaian Laporan Kemajuan
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formEditPertanyaanLaporanKemajuan">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <input type="hidden" id="edit_pertanyaan_laporan_kemajuan_id" name="pertanyaan_id">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="edit_pertanyaan_laporan_kemajuan" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="edit_pertanyaan_laporan_kemajuan" name="pertanyaan" rows="3" required></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_bobot_laporan_kemajuan" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_bobot_laporan_kemajuan" name="bobot" min="1" max="100" required>
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_skor_laporan_kemajuan" class="form-label">Skor Maksimal <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_skor_laporan_kemajuan" name="skor" min="1" max="100" required>
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan reviewer</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_status_laporan_kemajuan" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="edit_status_laporan_kemajuan" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-warning btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Update
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Tambah Pertanyaan Penilaian Laporan Akhir -->
                <div class="modal fade" id="modalTambahPertanyaanLaporanAkhir" tabindex="-1" aria-labelledby="modalTambahPertanyaanLaporanAkhirLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalTambahPertanyaanLaporanAkhirLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-plus-circle me-2"></i>Tambah Pertanyaan Penilaian Laporan Akhir
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formTambahPertanyaanLaporanAkhir">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="pertanyaan_laporan_akhir" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="pertanyaan_laporan_akhir" name="pertanyaan" rows="3" required placeholder="Masukkan pertanyaan penilaian untuk reviewer..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="bobot_laporan_akhir" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="bobot_laporan_akhir" name="bobot" min="1" max="100" required placeholder="Contoh: 25">
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Skor Maksimal</label>
                                                <div class="form-control-plaintext" id="skor_laporan_akhir_display" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.375rem 0.75rem;">
                                                    <span id="skor_laporan_akhir_value">100</span>
                                                    <small class="text-muted ms-2">(Default dari pengaturan)</small>
                                                </div>
                                                <input type="hidden" id="skor_laporan_akhir" name="skor" value="100">
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan reviewer</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="status_laporan_akhir" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="status_laporan_akhir" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-primary btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Simpan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Edit Pertanyaan Penilaian Laporan Akhir -->
                <div class="modal fade" id="modalEditPertanyaanLaporanAkhir" tabindex="-1" aria-labelledby="modalEditPertanyaanLaporanAkhirLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <div class="modal-header" style="background: #ffffff; border-bottom: 1px solid #e9ecef; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                <h5 class="modal-title" id="modalEditPertanyaanLaporanAkhirLabel" style="font-weight: 600; color: #2c3e50; font-size: 1.25rem;">
                                    <i class="bi bi-pencil me-2"></i>Edit Pertanyaan Penilaian Laporan Akhir
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="formEditPertanyaanLaporanAkhir">
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <input type="hidden" id="edit_pertanyaan_laporan_akhir_id" name="pertanyaan_id">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label for="edit_pertanyaan_laporan_akhir" class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="edit_pertanyaan_laporan_akhir" name="pertanyaan" rows="3" required></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_bobot_laporan_akhir" class="form-label">Bobot <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_bobot_laporan_akhir" name="bobot" min="1" max="100" required>
                                                <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_skor_laporan_akhir" class="form-label">Skor Maksimal <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="edit_skor_laporan_akhir" name="skor" min="1" max="100" required>
                                                <small class="text-muted">Skor tertinggi yang bisa diberikan reviewer</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit_status_laporan_akhir" class="form-label">Status <span class="text-danger">*</span></label>
                                                <select class="form-select" id="edit_status_laporan_akhir" name="status" required>
                                                    <option value="Aktif">Aktif</option>
                                                    <option value="Nonaktif">Nonaktif</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: #ffffff; border-top: 1px solid #e9ecef; border-radius: 0 0 12px 12px; padding: 1.5rem;">
                                    <button type="button" class="btn btn-secondary btn-rounded-pill" data-bs-dismiss="modal" style="border: 1px solid #6c757d; border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500; background: #6c757d; color: white;">Batal</button>
                                    <button type="submit" class="btn btn-warning btn-rounded-pill" style="border-radius: 8px; padding: 0.75rem 1.5rem; font-weight: 500;">
                                        <i class="bi bi-save me-2"></i>Update
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>


    <script src="{{ url_for('static', filename='assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/bootstrap.bundle.min.js') }}"></script>

    <script src="{{ url_for('static', filename='assets/vendors/jquery/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/vendors/jquery-datatables/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/vendors/jquery-datatables/custom.jquery.dataTables.bootstrap5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/vendors/fontawesome/all.min.js') }}"></script>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/id.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script src="{{ url_for('static', filename='assets/vendors/choices.js/choices.min.js') }}"></script>

    <script src="{{ url_for('static', filename='assets/js/mazer.js') }}"></script>

    <style>
        .list-group-item {
            border: none;
            border-radius: 8px !important;
            margin-bottom: 5px;
            transition: all 0.3s ease;
            font-weight: 500;
            padding: 12px 16px;
        }
        
        .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        
        .list-group-item.active {
            background-color: #435ebe !important;
            border-color: #435ebe !important;
            color: white !important;
        }
        
        .list-group-item.active:hover {
            background-color: #3a4f9e !important;
        }

        /* Tombol Aksi Bulat */
        .btn-rounded-circle {
            width: 32px;
            height: 32px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50% !important;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-rounded-circle:hover {
            transform: scale(1.1);
        }

        .btn-rounded-circle i {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            font-size: 0.875rem;
            line-height: 1;
            margin: 0;
            padding: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Override untuk memastikan icon terpusat sempurna */
        .btn-rounded-circle .bi {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 100% !important;
            height: 100% !important;
            font-size: 0.875rem !important;
            line-height: 1 !important;
            margin: 0 !important;
            padding: 0 !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }

        /* Tombol Navigasi Bulat */
        .btn-rounded-pill {
            border-radius: 50px !important;
            padding: 8px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-rounded-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        /* Gaya seragam: samakan tampilan semua tombol submit/simpan dengan tombol "Simpan Pengaturan Bimbingan" */
        button[type="submit"].btn {
            border-radius: 8px !important;
            padding: 12px 24px !important;
            font-weight: 600 !important;
            transition: all 0.3s ease;
        }
        button[type="submit"].btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .card {
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1) !important;
        }
        
        .tab-pane {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .list-group-item {
                margin-bottom: 3px;
                font-size: 14px;
            }
            
            .card {
                margin-bottom: 15px;
            }
            
            .btn-sm {
                font-size: 12px;
                padding: 4px 8px;
            }
        }

        @media (max-width: 576px) {
            .col-sm-12 {
                margin-bottom: 20px;
            }
            
            .table-responsive {
                font-size: 12px;
            }
            
            .btn {
                font-size: 12px;
                padding: 6px 12px;
            }
        }

        /* Badge untuk kategori */
        .bg-purple {
            background-color: #6f42c1 !important;
        }

        /* DataTable Pagination Bootstrap Style (SAMA DENGAN mahasiswa_belum_diverifikasi) */
        .dataTables_wrapper .dataTables_paginate .pagination {
            justify-content: center;
            gap: 8px;
        }
        .dataTables_wrapper .dataTables_paginate .page-item {
            margin: 0;
        }
        .dataTables_wrapper .dataTables_paginate .page-link {
            border-radius: 50% !important;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            padding: 0 !important;
            margin: 0 !important;
            font-weight: 600;
            font-size: 1.1rem;
            line-height: 40px;
            border: none;
            background: transparent;
            color: #3b3f5c;
            transition: background 0.2s, color 0.2s;
            text-align: center;
        }
        .dataTables_wrapper .dataTables_paginate .page-link:focus {
            box-shadow: none;
        }
        .dataTables_wrapper .dataTables_paginate .page-item.active .page-link,
        .dataTables_wrapper .dataTables_paginate .page-link:hover {
            background: #435ebe;
            color: #fff !important;
        }
        .dataTables_wrapper .dataTables_paginate .page-link:active {
            background: #25396f;
            color: #fff !important;
        }
        .dataTables_wrapper .dataTables_paginate .page-link svg {
            vertical-align: middle;
        }
        /* Hapus style custom pagination sebelumnya agar tidak bentrok */
        .dataTables_wrapper .dataTables_paginate .paginate_button,
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover,
        .dataTables_wrapper .dataTables_paginate .paginate_button:active,
        .dataTables_wrapper .dataTables_paginate .paginate_button:focus,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover,
        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled,
        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled:hover {
            all: unset !important;
        }
    </style>

    <script>
        // Variabel global untuk DataTable
        let programStudiTable;
        let pertanyaanMahasiswaTable;
        let pertanyaanProposalTable;
        let pertanyaanLaporanKemajuanTable;
        let pertanyaanLaporanAkhirTable;
        
        // Inisialisasi DataTable
        $(document).ready(function() {
            programStudiTable = $('#tableProgramStudi').DataTable({
                "language": {
                    "sProcessing":   "Sedang memproses...",
                    "sLengthMenu":   "Tampilkan _MENU_ entri",
                    "sZeroRecords":  "Tidak ditemukan data yang sesuai",
                    "sInfo":         "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                    "sInfoEmpty":    "Menampilkan 0 sampai 0 dari 0 entri",
                    "sInfoFiltered": "(disaring dari _MAX_ entri keseluruhan)",
                    "sInfoPostFix":  "",
                    "sSearch":       "Cari:",
                    "sUrl":          "",
                    "oPaginate": {
                        "sFirst":    "Pertama",
                        "sPrevious": "Sebelumnya",
                        "sNext":     "Selanjutnya",
                        "sLast":     "Terakhir"
                    }
                },
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Semua"]],
                "order": [[1, "asc"]],
                "responsive": true,
                "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                       '<"row"<"col-sm-12"tr>>' +
                       '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
                "pagingType": "simple_numbers",
                "drawCallback": function(settings) {
                    // Tambahkan class untuk styling pagination
                    $('.dataTables_paginate .paginate_button').addClass('btn-rounded-pill');
                    
                    // Force reapply styling untuk memastikan lingkaran sempurna
                    function forceCircularButtons() {
                        $('.dataTables_paginate .paginate_button').each(function() {
                            $(this).attr('style', ''); // Reset semua inline style
                            $(this).css({
                                'all': 'unset',
                                'border-radius': '50%',
                                'width': '40px',
                                'height': '40px',
                                'min-width': '40px',
                                'min-height': '40px',
                                'max-width': '40px',
                                'max-height': '40px',
                                'padding': '0',
                                'margin': '0 3px',
                                'display': 'inline-flex',
                                'align-items': 'center',
                                'justify-content': 'center',
                                'text-align': 'center',
                                'line-height': '1',
                                'border': '2px solid #e9ecef',
                                'background': 'white',
                                'color': '#6c757d',
                                'font-weight': '600',
                                'font-size': '14px',
                                'box-shadow': '0 2px 4px rgba(0,0,0,0.1)',
                                'transition': 'all 0.3s ease',
                                'cursor': 'pointer',
                                'box-sizing': 'border-box'
                            });
                        });
                        
                        // Styling khusus untuk tombol active
                        $('.dataTables_paginate .paginate_button.current').css({
                            'background': '#435ebe',
                            'color': 'white',
                            'border-color': '#435ebe',
                            'box-shadow': '0 4px 12px rgba(67, 94, 190, 0.4)'
                        });
                        
                        // Styling khusus untuk tombol disabled
                        $('.dataTables_paginate .paginate_button.disabled').css({
                            'background': '#f8f9fa',
                            'color': '#adb5bd',
                            'border-color': '#e9ecef',
                            'cursor': 'not-allowed',
                            'box-shadow': 'none'
                        });
                    }
                    
                    // Jalankan multiple kali untuk memastikan styling diterapkan
                    forceCircularButtons();
                    setTimeout(forceCircularButtons, 50);
                    setTimeout(forceCircularButtons, 100);
                    setTimeout(forceCircularButtons, 200);
                }
            });

            // Aktifkan tab pertama saat halaman dimuat
            $('.list-group-item:first').addClass('active');
            $('#informasi').addClass('show active');
            
            // Load data untuk semua tabel penilaian saat halaman dimuat
            refreshPertanyaanMahasiswaTable();
            refreshPertanyaanProposalTable();
            refreshPertanyaanLaporanKemajuanTable();
            refreshPertanyaanLaporanAkhirTable();

            // Handle klik pada menu sidebar
            $('.list-group-item').on('click', function() {
                $('.list-group-item').removeClass('active');
                $(this).addClass('active');
                
                // Load data berdasarkan tab yang aktif
                const targetTab = $(this).attr('href');
                if (targetTab === '#pengaturan-default') {
                    loadPengaturanDefault();
                } else if (targetTab === '#penilaian-mahasiswa') {
                    refreshPertanyaanMahasiswaTable();
                } else if (targetTab === '#penilaian-proposal') {
                    refreshPertanyaanProposalTable();
                } else if (targetTab === '#penilaian-laporan-kemajuan') {
                    refreshPertanyaanLaporanKemajuanTable();
                } else if (targetTab === '#penilaian-laporan-akhir') {
                    refreshPertanyaanLaporanAkhirTable();
                } else if (targetTab === '#pengaturan-anggaran') {
                    loadPengaturanAnggaran();
                }
            });

            // Inisialisasi DataTable untuk Pertanyaan Penilaian Mahasiswa
            pertanyaanMahasiswaTable = $('#tablePertanyaanMahasiswa').DataTable({
                "language": {
                    "sProcessing":   "Sedang memproses...",
                    "sLengthMenu":   "Tampilkan _MENU_ entri",
                    "sZeroRecords":  "Tidak ditemukan data yang sesuai",
                    "sInfo":         "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                    "sInfoEmpty":    "Menampilkan 0 sampai 0 dari 0 entri",
                    "sInfoFiltered": "(disaring dari _MAX_ entri keseluruhan)",
                    "sInfoPostFix":  "",
                    "sSearch":       "Cari:",
                    "sUrl":          "",
                    "oPaginate": {
                        "sFirst":    "Pertama",
                        "sPrevious": "Sebelumnya",
                        "sNext":     "Selanjutnya",
                        "sLast":     "Terakhir"
                    }
                },
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Semua"]],
                "order": [], // Tidak perlu sorting karena data sudah diurutkan di backend
                "ordering": false, // Nonaktifkan sorting otomatis
                "responsive": true,
                "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                       '<"row"<"col-sm-12"tr>>' +
                       '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
                "pagingType": "simple_numbers"
            });

            // Inisialisasi DataTable untuk Pertanyaan Penilaian Proposal
            pertanyaanProposalTable = $('#tablePertanyaanProposal').DataTable({
                "language": {
                    "sProcessing":   "Sedang memproses...",
                    "sLengthMenu":   "Tampilkan _MENU_ entri",
                    "sZeroRecords":  "Tidak ditemukan data yang sesuai",
                    "sInfo":         "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                    "sInfoEmpty":    "Menampilkan 0 sampai 0 dari 0 entri",
                    "sInfoFiltered": "(disaring dari _MAX_ entri keseluruhan)",
                    "sInfoPostFix":  "",
                    "sSearch":       "Cari:",
                    "sUrl":          "",
                    "oPaginate": {
                        "sFirst":    "Pertama",
                        "sPrevious": "Sebelumnya",
                        "sNext":     "Selanjutnya",
                        "sLast":     "Terakhir"
                    }
                },
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Semua"]],
                "order": [[1, "asc"]],
                "responsive": true,
                "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                       '<"row"<"col-sm-12"tr>>' +
                       '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
                "pagingType": "simple_numbers"
            });

            // Inisialisasi DataTable untuk Pertanyaan Penilaian Laporan Kemajuan
            pertanyaanLaporanKemajuanTable = $('#tablePertanyaanLaporanKemajuan').DataTable({
                "language": {
                    "sProcessing":   "Sedang memproses...",
                    "sLengthMenu":   "Tampilkan _MENU_ entri",
                    "sZeroRecords":  "Tidak ditemukan data yang sesuai",
                    "sInfo":         "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                    "sInfoEmpty":    "Menampilkan 0 sampai 0 dari 0 entri",
                    "sInfoFiltered": "(disaring dari _MAX_ entri keseluruhan)",
                    "sInfoPostFix":  "",
                    "sSearch":       "Cari:",
                    "sUrl":          "",
                    "oPaginate": {
                        "sFirst":    "Pertama",
                        "sPrevious": "Sebelumnya",
                        "sNext":     "Selanjutnya",
                        "sLast":     "Terakhir"
                    }
                },
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Semua"]],
                "order": [[1, "asc"]],
                "responsive": true,
                "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                       '<"row"<"col-sm-12"tr>>' +
                       '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
                "pagingType": "simple_numbers"
            });

            // Inisialisasi DataTable untuk Pertanyaan Penilaian Laporan Akhir
            pertanyaanLaporanAkhirTable = $('#tablePertanyaanLaporanAkhir').DataTable({
                "language": {
                    "sProcessing":   "Sedang memproses...",
                    "sLengthMenu":   "Tampilkan _MENU_ entri",
                    "sZeroRecords":  "Tidak ditemukan data yang sesuai",
                    "sInfo":         "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                    "sInfoEmpty":    "Menampilkan 0 sampai 0 dari 0 entri",
                    "sInfoFiltered": "(disaring dari _MAX_ entri keseluruhan)",
                    "sInfoPostFix":  "",
                    "sSearch":       "Cari:",
                    "sUrl":          "",
                    "oPaginate": {
                        "sFirst":    "Pertama",
                        "sPrevious": "Sebelumnya",
                        "sNext":     "Selanjutnya",
                        "sLast":     "Terakhir"
                    }
                },
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Semua"]],
                "order": [[1, "asc"]],
                "responsive": true,
                "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                       '<"row"<"col-sm-12"tr>>' +
                       '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
                "pagingType": "simple_numbers"
            });
        });

        // Fungsi untuk refresh tabel program studi
        function refreshProgramStudiTable() {
            $.ajax({
                url: '{{ url_for("admin.get_program_studi_data") }}',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        // Clear DataTable
                        programStudiTable.clear();
                        
                        // Tambahkan data baru
                        response.data.forEach(function(item) {
                            const actionButtons = `
                                <button type="button" class="btn btn-sm btn-warning me-1 btn-rounded-circle" 
                                        onclick="editProgramStudi(${item.id}, '${item.nama_program_studi}')"
                                        title="Edit"
                                        style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-pencil" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-danger btn-rounded-circle" 
                                        onclick="deleteProgramStudi(${item.id}, '${item.nama_program_studi}')"
                                        title="Hapus"
                                        style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-trash" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>
                                </button>
                            `;
                            
                            programStudiTable.row.add([
                                item.no,
                                item.nama_program_studi,
                                item.created_at,
                                actionButtons
                            ]);
                        });
                        
                        // Redraw DataTable
                        programStudiTable.draw();
                    } else {
                        console.error('Gagal refresh tabel program studi:', response.message);
                    }
                },
                error: function() {
                    console.error('Gagal refresh tabel program studi');
                }
            });
        }



        // Tambah Program Studi
        $('#formTambahProgramStudi').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            $.ajax({
                url: '{{ url_for("admin.add_program_studi") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            // Refresh hanya tabel tanpa reload halaman
                            refreshProgramStudiTable();
                            // Tutup modal
                            $('#modalTambahProgramStudi').modal('hide');
                            // Reset form
                            $('#formTambahProgramStudi')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat menambah program studi'
                    });
                }
            });
        });

        // Edit Program Studi
        function editProgramStudi(id, nama) {
            $('#edit_program_studi_id').val(id);
            $('#edit_nama_program_studi').val(nama);
            $('#modalEditProgramStudi').modal('show');
        }

        // Update Program Studi
        $('#formEditProgramStudi').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            $.ajax({
                url: '{{ url_for("admin.update_program_studi") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            // Refresh hanya tabel tanpa reload halaman
                            refreshProgramStudiTable();
                            // Tutup modal
                            $('#modalEditProgramStudi').modal('hide');
                            // Reset form
                            $('#formEditProgramStudi')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat memperbarui program studi'
                    });
                }
            });
        });

        // Delete Program Studi
        function deleteProgramStudi(id, nama) {
            Swal.fire({
                title: 'Konfirmasi Hapus',
                text: `Apakah Anda yakin ingin menghapus program studi "${nama}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const formData = new FormData();
                    formData.append('program_studi_id', id);
                    
                    $.ajax({
                        url: '{{ url_for("admin.delete_program_studi") }}',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: response.message,
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {
                                    // Refresh hanya tabel tanpa reload halaman
                                    refreshProgramStudiTable();
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal!',
                                    text: response.message
                                });
                            }
                        },
                        error: function() {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Terjadi kesalahan saat menghapus program studi'
                            });
                        }
                    });
                }
            });
        }

        // ==================== FUNGSI PERTANYAAN PENILAIAN MAHASISWA ====================
        
        // Handle dropdown kategori
        $(document).on('click', '.dropdown-item[data-kategori]', function(e) {
            e.preventDefault();
            const kategori = $(this).data('kategori');
            const kategoriText = $(this).text().trim();
            
            // Set kategori yang dipilih
            $('#kategori_mahasiswa').val(kategori);
            $('#kategoriDipilih').text(kategoriText);
            
            // Reset form pertanyaan dinamis
            resetFormPertanyaanDinamis();
        });
        
        // Reset form pertanyaan dinamis
        function resetFormPertanyaanDinamis() {
            $('#formPertanyaanDinamis').html(`
                <div class="pertanyaan-form mb-4" data-index="0">
                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 8px;">
                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; padding: 0.75rem 1rem;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                    <i class="bi bi-list-ol me-2"></i>Pertanyaan #1
                                </h6>
                                <button type="button" class="btn btn-sm btn-outline-danger hapus-pertanyaan" data-index="0" style="display: none;">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                    <textarea class="form-control pertanyaan-input" name="pertanyaan[]" rows="2" required placeholder="Masukkan pertanyaan penilaian..."></textarea>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Bobot <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control bobot-input" name="bobot[]" min="1" max="100" required placeholder="Contoh: 25">
                                    <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Skor Maksimal</label>
                                    <div class="form-control-plaintext" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.375rem 0.75rem;">
                                        <span class="skor-default-value">100</span>
                                        <small class="text-muted ms-2">(Default dari pengaturan)</small>
                                    </div>
                                    <input type="hidden" class="skor-input" name="skor[]" value="100">
                                    <small class="text-muted">Skor tertinggi yang bisa diberikan pembimbing</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Status <span class="text-danger">*</span></label>
                                    <select class="form-select status-input" name="status[]" required>
                                        <option value="Aktif">Aktif</option>
                                        <option value="Nonaktif">Nonaktif</option>
                                    </select>
                                    <small class="text-muted">Status pertanyaan penilaian</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `);
            
            // Set skor default
            const defaultSkor = localStorage.getItem('default_skor_mahasiswa') || 100;
            $('.skor-default-value').text(defaultSkor);
            $('.skor-input').val(defaultSkor);
        }
        
        // Tambah pertanyaan baru
        $('#tambahPertanyaanBtn').on('click', function() {
            const currentIndex = $('.pertanyaan-form').length;
            const newIndex = currentIndex + 1;
            
            const newForm = `
                <div class="pertanyaan-form mb-4" data-index="${newIndex}">
                    <div class="card" style="border: 1px solid #e9ecef; border-radius: 8px;">
                        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e9ecef; padding: 0.75rem 1rem;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0" style="color: #435ebe; font-weight: 600;">
                                    <i class="bi bi-list-ol me-2"></i>Pertanyaan #${newIndex + 1}
                                </h6>
                                <button type="button" class="btn btn-sm btn-outline-danger hapus-pertanyaan" data-index="${newIndex}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Pertanyaan <span class="text-danger">*</span></label>
                                    <textarea class="form-control pertanyaan-input" name="pertanyaan[]" rows="2" required placeholder="Masukkan pertanyaan penilaian..."></textarea>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Bobot <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control bobot-input" name="bobot[]" min="1" max="100" required placeholder="Contoh: 25">
                                    <small class="text-muted">Bobot kepentingan kriteria ini (seperti SKS mata kuliah)</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Skor Maksimal</label>
                                    <div class="form-control-plaintext" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.375rem 0.75rem;">
                                        <span class="skor-default-value">100</span>
                                        <small class="text-muted ms-2">(Default dari pengaturan)</small>
                                    </div>
                                    <input type="hidden" class="skor-input" name="skor[]" value="100">
                                    <small class="text-muted">Skor tertinggi yang bisa diberikan pembimbing</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Status <span class="text-danger">*</span></label>
                                    <select class="form-select status-input" name="status[]" required>
                                        <option value="Aktif">Aktif</option>
                                        <option value="Nonaktif">Nonaktif</option>
                                    </select>
                                    <small class="text-muted">Status pertanyaan penilaian</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            $('#formPertanyaanDinamis').append(newForm);
            
            // Set skor default untuk form baru
            const defaultSkor = localStorage.getItem('default_skor_mahasiswa') || 100;
            $(`.pertanyaan-form[data-index="${newIndex}"] .skor-default-value`).text(defaultSkor);
            $(`.pertanyaan-form[data-index="${newIndex}"] .skor-input`).val(defaultSkor);
            
            // Update nomor pertanyaan
            updateNomorPertanyaan();
        });
        
        // Hapus pertanyaan
        $(document).on('click', '.hapus-pertanyaan', function() {
            const index = $(this).data('index');
            $(`.pertanyaan-form[data-index="${index}"]`).remove();
            updateNomorPertanyaan();
        });
        
        // Update nomor pertanyaan
        function updateNomorPertanyaan() {
            $('.pertanyaan-form').each(function(index) {
                $(this).attr('data-index', index);
                $(this).find('h6').html(`<i class="bi bi-list-ol me-2"></i>Pertanyaan #${index + 1}`);
                $(this).find('.hapus-pertanyaan').attr('data-index', index);
                
                // Sembunyikan tombol hapus jika hanya ada 1 pertanyaan
                if ($('.pertanyaan-form').length === 1) {
                    $(this).find('.hapus-pertanyaan').hide();
                } else {
                    $(this).find('.hapus-pertanyaan').show();
                }
            });
        }
        
        // Handle submit form pertanyaan dinamis
        $('#formTambahPertanyaanMahasiswa').on('submit', function(e) {
            e.preventDefault();
            
            // Validasi kategori
            const kategori = $('#kategori_mahasiswa').val();
            if (!kategori) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Peringatan!',
                    text: 'Silakan pilih kategori terlebih dahulu!'
                });
                return;
            }
            
            // Validasi form
            const pertanyaanForms = $('.pertanyaan-form');
            if (pertanyaanForms.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Peringatan!',
                    text: 'Minimal harus ada 1 pertanyaan!'
                });
                return;
            }
            
            // Validasi setiap pertanyaan
            let isValid = true;
            pertanyaanForms.each(function() {
                const pertanyaan = $(this).find('.pertanyaan-input').val().trim();
                const bobot = $(this).find('.bobot-input').val();
                const status = $(this).find('.status-input').val();
                
                if (!pertanyaan || !bobot || !status) {
                    isValid = false;
                    return false;
                }
            });
            
            if (!isValid) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Peringatan!',
                    text: 'Semua field pertanyaan, bobot, dan status harus diisi!'
                });
                return;
            }
            
            // Tampilkan loading
            const submitBtn = $(this).find('button[type="submit"]');
            const originalText = submitBtn.html();
            submitBtn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Menyimpan...');
            
            // Proses setiap pertanyaan
            const pertanyaanData = [];
            pertanyaanForms.each(function() {
                const pertanyaan = $(this).find('.pertanyaan-input').val().trim();
                const bobot = $(this).find('.bobot-input').val();
                const skor = $(this).find('.skor-input').val();
                const status = $(this).find('.status-input').val();
                
                pertanyaanData.push({
                    kategori: kategori,
                    pertanyaan: pertanyaan,
                    bobot: bobot,
                    skor: skor,
                    status: status
                });
            });
            
            // Kirim data ke server
            $.ajax({
                url: '{{ url_for("admin.add_pertanyaan_penilaian") }}',
                type: 'POST',
                data: JSON.stringify(pertanyaanData),
                contentType: 'application/json',
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        });
                        
                        // Tutup modal dan refresh tabel
                        $('#modalTambahPertanyaanMahasiswa').modal('hide');
                        refreshPertanyaanMahasiswaTable();
                        
                        // Reset form
                        resetFormPertanyaanDinamis();
                        $('#kategori_mahasiswa').val('');
                        $('#kategoriDipilih').text('-');
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat menyimpan pertanyaan!'
                    });
                },
                complete: function() {
                    submitBtn.prop('disabled', false).html(originalText);
                }
            });
        });

        // Edit Pertanyaan Penilaian Mahasiswa
        function editPertanyaanMahasiswa(id, kategori, pertanyaan, bobot, skor, status) {
            $('#edit_pertanyaan_mahasiswa_id').val(id);
            $('#edit_kategori_mahasiswa').val(kategori);
            $('#edit_pertanyaan_mahasiswa').val(pertanyaan);
            $('#edit_bobot_mahasiswa').val(bobot);
            $('#edit_skor_mahasiswa').val(skor);
            $('#edit_status_mahasiswa').val(status);
            $('#modalEditPertanyaanMahasiswa').modal('show');
        }

        // Update Pertanyaan Penilaian Mahasiswa
        $('#formEditPertanyaanMahasiswa').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'mahasiswa');
            
            $.ajax({
                url: '{{ url_for("admin.update_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanMahasiswaTable();
                            $('#modalEditPertanyaanMahasiswa').modal('hide');
                            $('#formEditPertanyaanMahasiswa')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat memperbarui pertanyaan penilaian'
                    });
                }
            });
        });

        // Delete Pertanyaan Penilaian Mahasiswa
        function deletePertanyaanMahasiswa(id, pertanyaan) {
            Swal.fire({
                title: 'Konfirmasi Hapus',
                text: `Apakah Anda yakin ingin menghapus pertanyaan "${pertanyaan}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const formData = new FormData();
                    formData.append('pertanyaan_id', id);
                    formData.append('jenis_penilaian', 'mahasiswa');
                    
            $.ajax({
                        url: '{{ url_for("admin.delete_pertanyaan_penilaian") }}',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                success: function(response) {
                    if (response.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: response.message,
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {
                                    refreshPertanyaanMahasiswaTable();
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal!',
                                    text: response.message
                                });
                            }
                        },
                        error: function() {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Terjadi kesalahan saat menghapus pertanyaan penilaian'
                            });
                        }
                    });
                }
            });
        }

        // Format kategori untuk tampilan yang lebih baik
        function formatKategoriDisplay(kategori) {
            const kategoriMap = {
                'pondasi-bisnis': '<span class="badge bg-primary">Pondasi Bisnis</span>',
                'pelanggan': '<span class="badge bg-success">Pelanggan</span>',
                'produk-jasa': '<span class="badge bg-info">Produk/Jasa</span>',
                'pemasaran': '<span class="badge bg-warning">Pemasaran</span>',
                'penjualan': '<span class="badge bg-secondary">Penjualan</span>',
                'keuntungan': '<span class="badge bg-danger">Keuntungan</span>',
                'sdm': '<span class="badge bg-dark">Sumber Daya Manusia</span>',
                'sistem-bisnis': '<span class="badge bg-purple">Sistem Bisnis</span>'
            };
            return kategoriMap[kategori] || kategori;
        }

        // Refresh tabel pertanyaan mahasiswa
        function refreshPertanyaanMahasiswaTable() {
            $.ajax({
                url: '{{ url_for("admin.get_pertanyaan_penilaian_data") }}',
                type: 'GET',
                data: { jenis_penilaian: 'mahasiswa' },
                success: function(response) {
                    if (response.success) {
                        pertanyaanMahasiswaTable.clear();
                        response.data.forEach(function(item) {
                            // Buat tombol dengan data attributes untuk menghindari masalah JavaScript
                            const actionButtons = 
                                '<button type="button" class="btn btn-sm btn-warning me-1 btn-rounded-circle edit-mahasiswa-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-kategori="' + item.kategori + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'data-bobot="' + item.bobot_asli + '" ' +
                                'data-skor="' + item.skor + '" ' +
                                'data-status="' + item.status + '" ' +
                                'title="Edit" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-pencil" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>' +
                                '<button type="button" class="btn btn-sm btn-danger btn-rounded-circle delete-mahasiswa-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'title="Hapus" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-trash" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>';
                            
                            // Format kategori untuk tampilan yang lebih baik
                            const kategoriDisplay = formatKategoriDisplay(item.kategori);
                            
                            pertanyaanMahasiswaTable.row.add([
                                item.no,
                                kategoriDisplay,
                                item.pertanyaan,
                                item.bobot,
                                item.skor,
                                item.status,
                                actionButtons
                            ]);
                        });
                        pertanyaanMahasiswaTable.draw(false); // false = tidak reorder data
                        
                        // Bind event handlers setelah tabel di-render
                        bindMahasiswaTableEvents();
                    }
                }
            });
        }
        
        // Bind event handlers untuk tabel mahasiswa
        function bindMahasiswaTableEvents() {
            // Event untuk tombol edit
            $(document).off('click', '.edit-mahasiswa-btn').on('click', '.edit-mahasiswa-btn', function() {
                const id = $(this).data('id');
                const kategori = $(this).data('kategori');
                const pertanyaan = $(this).data('pertanyaan');
                const bobot = $(this).data('bobot');
                const skor = $(this).data('skor');
                const status = $(this).data('status');
                editPertanyaanMahasiswa(id, kategori, pertanyaan, bobot, skor, status);
            });
            
            // Event untuk tombol delete
            $(document).off('click', '.delete-mahasiswa-btn').on('click', '.delete-mahasiswa-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                deletePertanyaanMahasiswa(id, pertanyaan);
            });
        }

        // ==================== FUNGSI PERTANYAAN PENILAIAN PROPOSAL ====================
        
        // Tambah Pertanyaan Penilaian Proposal
        $('#formTambahPertanyaanProposal').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'proposal');
            
            $.ajax({
                url: '{{ url_for("admin.add_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanProposalTable();
                            $('#modalTambahPertanyaanProposal').modal('hide');
                            $('#formTambahPertanyaanProposal')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat menambah pertanyaan penilaian'
                    });
                }
            });
        });

        // Edit Pertanyaan Penilaian Proposal
        function editPertanyaanProposal(id, pertanyaan, bobot, skor, status) {
            $('#edit_pertanyaan_proposal_id').val(id);
            $('#edit_pertanyaan_proposal').val(pertanyaan);
            $('#edit_bobot_proposal').val(bobot);
            $('#edit_skor_proposal').val(skor);
            $('#edit_status_proposal').val(status);
            $('#modalEditPertanyaanProposal').modal('show');
        }

        // Update Pertanyaan Penilaian Proposal
        $('#formEditPertanyaanProposal').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'proposal');
            
            $.ajax({
                url: '{{ url_for("admin.update_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanProposalTable();
                            $('#modalEditPertanyaanProposal').modal('hide');
                            $('#formEditPertanyaanProposal')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat memperbarui pertanyaan penilaian'
                    });
                }
            });
        });

        // Delete Pertanyaan Penilaian Proposal
        function deletePertanyaanProposal(id, pertanyaan) {
            Swal.fire({
                title: 'Konfirmasi Hapus',
                text: `Apakah Anda yakin ingin menghapus pertanyaan "${pertanyaan}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const formData = new FormData();
                    formData.append('pertanyaan_id', id);
                    formData.append('jenis_penilaian', 'proposal');
                    
                    $.ajax({
                        url: '{{ url_for("admin.delete_pertanyaan_penilaian") }}',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: response.message,
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {
                                    refreshPertanyaanProposalTable();
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal!',
                                    text: response.message
                                });
                            }
                        },
                        error: function() {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Terjadi kesalahan saat menghapus pertanyaan penilaian'
                            });
                        }
                    });
                }
            });
        }

        // Refresh tabel pertanyaan proposal
        function refreshPertanyaanProposalTable() {
            $.ajax({
                url: '{{ url_for("admin.get_pertanyaan_penilaian_data") }}',
                type: 'GET',
                data: { jenis_penilaian: 'proposal' },
                success: function(response) {
                    if (response.success) {
                        pertanyaanProposalTable.clear();
                        response.data.forEach(function(item) {
                            // Buat tombol dengan data attributes untuk menghindari masalah JavaScript
                            const actionButtons = 
                                '<button type="button" class="btn btn-sm btn-warning me-1 btn-rounded-circle edit-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'data-bobot="' + item.bobot_asli + '" ' +
                                'data-skor="' + item.skor + '" ' +
                                'data-status="' + item.status + '" ' +
                                'title="Edit" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-pencil" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>' +
                                '<button type="button" class="btn btn-sm btn-danger btn-rounded-circle delete-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'title="Hapus" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-trash" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>';
                            
                            pertanyaanProposalTable.row.add([
                                item.no,
                                item.pertanyaan,
                                item.bobot,
                                item.skor,
                                item.status,
                                actionButtons
                            ]);
                        });
                        pertanyaanProposalTable.draw();
                        
                        // Bind event handlers setelah tabel di-render
                        bindProposalTableEvents();
                    }
                }
            });
        }
        
        // Bind event handlers untuk tabel proposal
        function bindProposalTableEvents() {
            // Event untuk tombol edit
            $(document).off('click', '.edit-btn').on('click', '.edit-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                const bobot = $(this).data('bobot');
                const skor = $(this).data('skor');
                const status = $(this).data('status');
                editPertanyaanProposal(id, pertanyaan, bobot, skor, status);
            });
            
            // Event untuk tombol delete
            $(document).off('click', '.delete-btn').on('click', '.delete-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                deletePertanyaanProposal(id, pertanyaan);
            });
        }

        // ==================== FUNGSI PERTANYAAN PENILAIAN LAPORAN KEMAJUAN ====================
        
        // Tambah Pertanyaan Penilaian Laporan Kemajuan
        $('#formTambahPertanyaanLaporanKemajuan').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'laporan_kemajuan');
            
            $.ajax({
                url: '{{ url_for("admin.add_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanLaporanKemajuanTable();
                            $('#modalTambahPertanyaanLaporanKemajuan').modal('hide');
                            $('#formTambahPertanyaanLaporanKemajuan')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat menambah pertanyaan penilaian'
                    });
                }
            });
        });

        // Edit Pertanyaan Penilaian Laporan Kemajuan
        function editPertanyaanLaporanKemajuan(id, pertanyaan, bobot, skor, status) {
            $('#edit_pertanyaan_laporan_kemajuan_id').val(id);
            $('#edit_pertanyaan_laporan_kemajuan').val(pertanyaan);
            $('#edit_bobot_laporan_kemajuan').val(bobot);
            $('#edit_skor_laporan_kemajuan').val(skor);
            $('#edit_status_laporan_kemajuan').val(status);
            $('#modalEditPertanyaanLaporanKemajuan').modal('show');
        }

        // Update Pertanyaan Penilaian Laporan Kemajuan
        $('#formEditPertanyaanLaporanKemajuan').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'laporan_kemajuan');
            
            $.ajax({
                url: '{{ url_for("admin.update_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanLaporanKemajuanTable();
                            $('#modalEditPertanyaanLaporanKemajuan').modal('hide');
                            $('#formEditPertanyaanLaporanKemajuan')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat memperbarui pertanyaan penilaian'
                    });
                }
            });
        });

        // Delete Pertanyaan Penilaian Laporan Kemajuan
        function deletePertanyaanLaporanKemajuan(id, pertanyaan) {
            Swal.fire({
                title: 'Konfirmasi Hapus',
                text: `Apakah Anda yakin ingin menghapus pertanyaan "${pertanyaan}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const formData = new FormData();
                    formData.append('pertanyaan_id', id);
                    formData.append('jenis_penilaian', 'laporan_kemajuan');
                    
                    $.ajax({
                        url: '{{ url_for("admin.delete_pertanyaan_penilaian") }}',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: response.message,
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {
                                    refreshPertanyaanLaporanKemajuanTable();
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal!',
                                    text: response.message
                                });
                            }
                        },
                        error: function() {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Terjadi kesalahan saat menghapus pertanyaan penilaian'
                            });
                        }
                    });
                }
            });
        }

        // Refresh tabel pertanyaan laporan kemajuan
        function refreshPertanyaanLaporanKemajuanTable() {
            $.ajax({
                url: '{{ url_for("admin.get_pertanyaan_penilaian_data") }}',
                type: 'GET',
                data: { jenis_penilaian: 'laporan_kemajuan' },
                success: function(response) {
                    if (response.success) {
                        pertanyaanLaporanKemajuanTable.clear();
                        response.data.forEach(function(item) {
                            // Buat tombol dengan data attributes untuk menghindari masalah JavaScript
                            const actionButtons = 
                                '<button type="button" class="btn btn-sm btn-warning me-1 btn-rounded-circle edit-kemajuan-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'data-bobot="' + item.bobot_asli + '" ' +
                                'data-skor="' + item.skor + '" ' +
                                'data-status="' + item.status + '" ' +
                                'title="Edit" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-pencil" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>' +
                                '<button type="button" class="btn btn-sm btn-danger btn-rounded-circle delete-kemajuan-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'title="Hapus" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-trash" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>';
                            
                            pertanyaanLaporanKemajuanTable.row.add([
                                item.no,
                                item.pertanyaan,
                                item.bobot,
                                item.skor,
                                item.status,
                                actionButtons
                            ]);
                        });
                        pertanyaanLaporanKemajuanTable.draw();
                        
                        // Bind event handlers setelah tabel di-render
                        bindKemajuanTableEvents();
                    }
                }
            });
        }
        
        // Bind event handlers untuk tabel laporan kemajuan
        function bindKemajuanTableEvents() {
            // Event untuk tombol edit
            $(document).off('click', '.edit-kemajuan-btn').on('click', '.edit-kemajuan-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                const bobot = $(this).data('bobot');
                const skor = $(this).data('skor');
                const status = $(this).data('status');
                editPertanyaanLaporanKemajuan(id, pertanyaan, bobot, skor, status);
            });
            
            // Event untuk tombol delete
            $(document).off('click', '.delete-kemajuan-btn').on('click', '.delete-kemajuan-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                deletePertanyaanLaporanKemajuan(id, pertanyaan);
            });
        }

        // ==================== FUNGSI PERTANYAAN PENILAIAN LAPORAN AKHIR ====================
        
        // Tambah Pertanyaan Penilaian Laporan Akhir
        $('#formTambahPertanyaanLaporanAkhir').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'laporan_akhir');
            
            $.ajax({
                url: '{{ url_for("admin.add_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanLaporanAkhirTable();
                            $('#modalTambahPertanyaanLaporanAkhir').modal('hide');
                            $('#formTambahPertanyaanLaporanAkhir')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat menambah pertanyaan penilaian'
                    });
                }
            });
        });

        // Edit Pertanyaan Penilaian Laporan Akhir
        function editPertanyaanLaporanAkhir(id, pertanyaan, bobot, skor, status) {
            $('#edit_pertanyaan_laporan_akhir_id').val(id);
            $('#edit_pertanyaan_laporan_akhir').val(pertanyaan);
            $('#edit_bobot_laporan_akhir').val(bobot);
            $('#edit_skor_laporan_akhir').val(skor);
            $('#edit_status_laporan_akhir').val(status);
            $('#modalEditPertanyaanLaporanAkhir').modal('show');
        }

        // Update Pertanyaan Penilaian Laporan Akhir
        $('#formEditPertanyaanLaporanAkhir').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('jenis_penilaian', 'laporan_akhir');
            
            $.ajax({
                url: '{{ url_for("admin.update_pertanyaan_penilaian") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            refreshPertanyaanLaporanAkhirTable();
                            $('#modalEditPertanyaanLaporanAkhir').modal('hide');
                            $('#formEditPertanyaanLaporanAkhir')[0].reset();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Terjadi kesalahan saat memperbarui pertanyaan penilaian'
                    });
                }
            });
        });

        // Delete Pertanyaan Penilaian Laporan Akhir
        function deletePertanyaanLaporanAkhir(id, pertanyaan) {
            Swal.fire({
                title: 'Konfirmasi Hapus',
                text: `Apakah Anda yakin ingin menghapus pertanyaan "${pertanyaan}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const formData = new FormData();
                    formData.append('pertanyaan_id', id);
                    formData.append('jenis_penilaian', 'laporan_akhir');
                    
                    $.ajax({
                        url: '{{ url_for("admin.delete_pertanyaan_penilaian") }}',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: response.message,
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {
                                    refreshPertanyaanLaporanAkhirTable();
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal!',
                                    text: response.message
                                });
                            }
                        },
                        error: function() {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Terjadi kesalahan saat menghapus pertanyaan penilaian'
                            });
                        }
                    });
                }
            });
        }

        // Refresh tabel pertanyaan laporan akhir
        function refreshPertanyaanLaporanAkhirTable() {
            $.ajax({
                url: '{{ url_for("admin.get_pertanyaan_penilaian_data") }}',
                type: 'GET',
                data: { jenis_penilaian: 'laporan_akhir' },
                success: function(response) {
                    if (response.success) {
                        pertanyaanLaporanAkhirTable.clear();
                        response.data.forEach(function(item) {
                            // Buat tombol dengan data attributes untuk menghindari masalah JavaScript
                            const actionButtons = 
                                '<button type="button" class="btn btn-sm btn-warning me-1 btn-rounded-circle edit-akhir-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'data-bobot="' + item.bobot_asli + '" ' +
                                'data-skor="' + item.skor + '" ' +
                                'data-status="' + item.status + '" ' +
                                'title="Edit" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-pencil" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>' +
                                '<button type="button" class="btn btn-sm btn-danger btn-rounded-circle delete-akhir-btn" ' +
                                'data-id="' + item.id + '" ' +
                                'data-pertanyaan="' + item.pertanyaan.replace(/"/g, '&quot;') + '" ' +
                                'title="Hapus" ' +
                                'style="width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">' +
                                '<i class="bi bi-trash" style="font-size: 0.875rem; line-height: 1; margin: 0; padding: 0;"></i>' +
                                '</button>';
                            
                            pertanyaanLaporanAkhirTable.row.add([
                                item.no,
                                item.pertanyaan,
                                item.bobot,
                                item.skor,
                                item.status,
                                actionButtons
                            ]);
                        });
                        pertanyaanLaporanAkhirTable.draw();
                        
                        // Bind event handlers setelah tabel di-render
                        bindAkhirTableEvents();
                    }
                }
            });
        }
        
        // Bind event handlers untuk tabel laporan akhir
        function bindAkhirTableEvents() {
            // Event untuk tombol edit
            $(document).off('click', '.edit-akhir-btn').on('click', '.edit-akhir-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                const bobot = $(this).data('bobot');
                const skor = $(this).data('skor');
                const status = $(this).data('status');
                editPertanyaanLaporanAkhir(id, pertanyaan, bobot, skor, status);
            });
            
            // Event untuk tombol delete
            $(document).off('click', '.delete-akhir-btn').on('click', '.delete-akhir-btn', function() {
                const id = $(this).data('id');
                const pertanyaan = $(this).data('pertanyaan');
                deletePertanyaanLaporanAkhir(id, pertanyaan);
            });
        }

        // Reset form saat modal ditutup
        $('#modalTambahProgramStudi').on('hidden.bs.modal', function() {
            $('#formTambahProgramStudi')[0].reset();
        });

        $('#modalEditProgramStudi').on('hidden.bs.modal', function() {
            $('#formEditProgramStudi')[0].reset();
        });
        
        // ==================== FUNGSI PENGATURAN DEFAULT ====================
        
        // Load pengaturan default saat halaman dimuat
        function loadPengaturanDefault() {
            // Ambil dari localStorage atau set default
            const defaultMahasiswa = localStorage.getItem('default_skor_mahasiswa') || 100;
            const defaultProposal = localStorage.getItem('default_skor_proposal') || 100;
            const defaultLaporanKemajuan = localStorage.getItem('default_skor_laporan_kemajuan') || 100;
            const defaultLaporanAkhir = localStorage.getItem('default_skor_laporan_akhir') || 100;
            const defaultKuotaMahasiswa = localStorage.getItem('default_kuota_mahasiswa') || 5;
            const defaultKuotaReview = localStorage.getItem('default_kuota_review') || 0;
            
            $('#default_skor_mahasiswa').val(defaultMahasiswa);
            $('#default_skor_proposal').val(defaultProposal);
            $('#default_skor_laporan_kemajuan').val(defaultLaporanKemajuan);
            $('#default_skor_laporan_akhir').val(defaultLaporanAkhir);
            $('#default_kuota_mahasiswa').val(defaultKuotaMahasiswa);
            $('#default_kuota_review').val(defaultKuotaReview);
        }
        
        // Simpan pengaturan default mahasiswa
        $('#formDefaultMahasiswa').on('submit', function(e) {
            e.preventDefault();
            const defaultSkor = $('#default_skor_mahasiswa').val();
            localStorage.setItem('default_skor_mahasiswa', defaultSkor);
            
            // Update display di modal jika sedang terbuka
            $('#skor_mahasiswa_value').text(defaultSkor);
            $('#skor_mahasiswa').val(defaultSkor);
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Pengaturan default skor maksimal untuk penilaian mahasiswa telah disimpan',
                showConfirmButton: false,
                timer: 1500
            });
        });
        
        // Simpan pengaturan default proposal
        $('#formDefaultProposal').on('submit', function(e) {
            e.preventDefault();
            const defaultSkor = $('#default_skor_proposal').val();
            localStorage.setItem('default_skor_proposal', defaultSkor);
            
            // Update display di modal jika sedang terbuka
            $('#skor_proposal_value').text(defaultSkor);
            $('#skor_proposal').val(defaultSkor);
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Pengaturan default skor maksimal untuk penilaian proposal telah disimpan',
                showConfirmButton: false,
                timer: 1500
            });
        });
        
        // Simpan pengaturan default laporan kemajuan
        $('#formDefaultLaporanKemajuan').on('submit', function(e) {
            e.preventDefault();
            const defaultSkor = $('#default_skor_laporan_kemajuan').val();
            localStorage.setItem('default_skor_laporan_kemajuan', defaultSkor);
            
            // Update display di modal jika sedang terbuka
            $('#skor_laporan_kemajuan_value').text(defaultSkor);
            $('#skor_laporan_kemajuan').val(defaultSkor);
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Pengaturan default skor maksimal untuk penilaian laporan kemajuan telah disimpan',
                showConfirmButton: false,
                timer: 1500
            });
        });
        
        // Simpan pengaturan default laporan akhir
        $('#formDefaultLaporanAkhir').on('submit', function(e) {
            e.preventDefault();
            const defaultSkor = $('#default_skor_laporan_akhir').val();
            localStorage.setItem('default_skor_laporan_akhir', defaultSkor);
            
            // Update display di modal jika sedang terbuka
            $('#skor_laporan_akhir_value').text(defaultSkor);
            $('#skor_laporan_akhir').val(defaultSkor);
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Pengaturan default skor maksimal untuk penilaian laporan akhir telah disimpan',
                showConfirmButton: false,
                timer: 1500
            });
        });

        // Simpan pengaturan default kuota mahasiswa
        $('#formDefaultKuotaMahasiswa').on('submit', function(e) {
            e.preventDefault();
            const defaultKuota = $('#default_kuota_mahasiswa').val();
            localStorage.setItem('default_kuota_mahasiswa', defaultKuota);
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Pengaturan default kuota mahasiswa untuk pembimbing telah disimpan',
                showConfirmButton: false,
                timer: 1500
            });
        });

        // Simpan pengaturan default kuota review
        $('#formDefaultKuotaReview').on('submit', function(e) {
            e.preventDefault();
            const defaultKuota = $('#default_kuota_review').val();
            localStorage.setItem('default_kuota_review', defaultKuota);
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Pengaturan default kuota review untuk reviewer telah disimpan',
                showConfirmButton: false,
                timer: 1500
            });
        });

        // ========================================
        // PENGATURAN BIMBINGAN
        // ========================================

        // Load pengaturan bimbingan saat halaman dimuat
        function loadPengaturanBimbingan() {
            $.ajax({
                url: '{{ url_for("admin.get_pengaturan_bimbingan") }}',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        const data = response.data;
                        $('#maksimal_bimbingan_per_hari').val(data.maksimal_bimbingan_per_hari);
                        const isAktif = data.status_aktif === 'aktif';
                        $('#status_aktif_switch').prop('checked', isAktif);
                        $('#status_aktif_label')
                            .toggleClass('bg-success', isAktif)
                            .toggleClass('bg-secondary', !isAktif)
                            .text(isAktif ? 'Aktif' : 'Nonaktif');
                        updatePreviewPesanBatasan();
                    } else {
                        console.error('Error loading pengaturan bimbingan:', response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                }
            });
        }

        // Load pengaturan bimbingan saat tab dibuka
        $('a[href="#pengaturan-bimbingan"]').on('shown.bs.tab', function() {
            loadPengaturanBimbingan();
        });

        // Handle form pengaturan bimbingan
        $('#formPengaturanBimbingan').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('maksimal_bimbingan_per_hari', $('#maksimal_bimbingan_per_hari').val());
            formData.append('status_aktif', $('#status_aktif_switch').is(':checked') ? 'aktif' : 'nonaktif');
            const $submitBtn = $(this).find('button[type="submit"]');
            const originalText = $submitBtn.html();
            $submitBtn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Menyimpan...');
            
            $.ajax({
                url: '{{ url_for("admin.update_pengaturan_bimbingan") }}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Berhasil!',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1200
                        });
                        // Refresh nilai di form tanpa reload halaman
                        loadPengaturanBimbingan();
                        // Pastikan tetap/berpindah ke tab Pengaturan Bimbingan
                        try {
                            const targetSel = 'a[href="#pengaturan-bimbingan"]';
                            const tabEl = document.querySelector(targetSel);
                            if (tabEl && window.bootstrap && bootstrap.Tab) {
                                bootstrap.Tab.getOrCreateInstance(tabEl).show();
                            } else if (tabEl && $(tabEl).tab) {
                                // Fallback jika jQuery plugin tersedia
                                $(tabEl).tab('show');
                            }
                            localStorage.setItem('admin_pengaturan_active_tab', '#pengaturan-bimbingan');
                        } catch (e) { /* ignore */ }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: response.message
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                    let errorMessage = 'Terjadi kesalahan saat menyimpan pengaturan bimbingan!';
                    
                    try {
                        const response = JSON.parse(xhr.responseText);
                        if (response.message) {
                            errorMessage = response.message;
                        }
                    } catch (e) {
                        // Jika response bukan JSON, gunakan pesan default
                    }
                    
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: errorMessage
                    });
                },
                complete: function() {
                    $submitBtn.prop('disabled', false).html(originalText);
                }
            });
        });

        // Perbarui pratinjau pesan otomatis saat maksimal berubah
        function updatePreviewPesanBatasan() {
            const max = parseInt($('#maksimal_bimbingan_per_hari').val() || 0, 10);
            const maxText = isNaN(max) || max <= 0 ? '3' : max.toString();
            $('#preview_pesan_batasan').text(
                `Anda telah mencapai batas maksimal bimbingan hari ini. Maksimal ${maxText} kali per hari. Silakan coba lagi besok.`
            );
        }
        $('#maksimal_bimbingan_per_hari').on('input change', updatePreviewPesanBatasan);
        $('#status_aktif_switch').on('change', function() {
            const isAktif = $(this).is(':checked');
            $('#status_aktif_label')
                .toggleClass('bg-success', isAktif)
                .toggleClass('bg-secondary', !isAktif)
                .text(isAktif ? 'Aktif' : 'Nonaktif');
        });

        // Simpan dan restore tab aktif agar tetap berada di tab yang sama tanpa reload
        $('a[data-bs-toggle="list"], a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
            const targetTab = $(e.target).attr('href');
            if (targetTab) {
                localStorage.setItem('admin_pengaturan_active_tab', targetTab);
                // Update active state pada menu sidebar
                $('.list-group-item').removeClass('active');
                $(this).addClass('active');
                
                // Pastikan konten tab ter-update dengan benar
                $('.tab-pane').removeClass('show active');
                $(targetTab).addClass('show active');
            }
        });
        
        // Restore tab aktif saat halaman dimuat
        (function restoreActiveTab(){
            const savedTab = localStorage.getItem('admin_pengaturan_active_tab');
            
            // Jika tidak ada tab tersimpan, gunakan tab default (Informasi Sistem)
            if (!savedTab) {
                const defaultTab = '#informasi';
                const defaultEl = document.querySelector('a[href="' + defaultTab + '"]');
                if (defaultEl) {
                    $('.list-group-item').removeClass('active');
                    $(defaultEl).addClass('active');
                    $(defaultTab).addClass('show active');
                }
                return;
            }
            
            const el = document.querySelector('a[href="' + savedTab + '"]');
            if (!el) return;
            
            try {
                // Update active state pada menu sidebar
                $('.list-group-item').removeClass('active');
                $(el).addClass('active');
                
                if (window.bootstrap && bootstrap.Tab) {
                    // Bootstrap 5.2+ has getOrCreateInstance; older 5.x gunakan constructor
                    if (typeof bootstrap.Tab.getOrCreateInstance === 'function') {
                        bootstrap.Tab.getOrCreateInstance(el).show();
                    } else {
                        new bootstrap.Tab(el).show();
                    }
                } else if (window.jQuery && typeof jQuery.fn.tab === 'function') {
                    jQuery(el).tab('show');
                } else {
                    el.click();
                }
            } catch (e) {
                // Fallback terakhir
                el.click();
            }
        })();

        // Pastikan tab aktif ter-restore dengan benar setelah semua elemen dimuat
        $(document).ready(function() {
            // Delay sedikit untuk memastikan Bootstrap sudah siap
            setTimeout(function() {
                const savedTab = localStorage.getItem('admin_pengaturan_active_tab');
                if (savedTab) {
                    const el = document.querySelector('a[href="' + savedTab + '"]');
                    if (el) {
                        // Update active state pada menu sidebar
                        $('.list-group-item').removeClass('active');
                        $(el).addClass('active');
                        
                        // Update konten tab
                        $('.tab-pane').removeClass('show active');
                        $(savedTab).addClass('show active');
                    }
                }
            }, 100);
        });

        // ========================================
        // PENGATURAN JADWAL
        // ========================================
        function loadPengaturanJadwal() {
            $.ajax({
                url: '{{ url_for("admin.get_pengaturan_jadwal") }}',
                type: 'GET',
                success: function(response) {
                    console.log('DEBUG: API response received:', response);
                    
                    if (response.success && response.data) {
                        const d = response.data;
                        console.log('DEBUG: Setting Flatpickr data:', {
                            pembimbing_nilai_mulai: d.pembimbing_nilai_mulai,
                            pembimbing_nilai_selesai: d.pembimbing_nilai_selesai,
                            pembimbing_interval_tipe: d.pembimbing_interval_tipe,
                            pembimbing_interval_nilai: d.pembimbing_interval_nilai
                        });
                        
                        // Set nilai ke Flatpickr jika sudah diinisialisasi
                        if (window.fpProposalMulai) fpProposalMulai.setDate(d.proposal_mulai || null, false);
                        if (window.fpProposalSelesai) fpProposalSelesai.setDate(d.proposal_selesai || null, false);
                        if (window.fpKemajuanMulai) fpKemajuanMulai.setDate(d.kemajuan_mulai || null, false);
                        if (window.fpKemajuanSelesai) fpKemajuanSelesai.setDate(d.kemajuan_selesai || null, false);
                        if (window.fpAkhirMulai) fpAkhirMulai.setDate(d.akhir_mulai || null, false);
                        if (window.fpAkhirSelesai) fpAkhirSelesai.setDate(d.akhir_selesai || null, false);
                        
                        // Jadwal penilaian dengan debug
                        if (window.fpPembimbingMulai && d.pembimbing_nilai_mulai) {
                            console.log('DEBUG: Setting fpPembimbingMulai to:', d.pembimbing_nilai_mulai);
                            fpPembimbingMulai.setDate(d.pembimbing_nilai_mulai, false);
                        }
                        if (window.fpPembimbingSelesai && d.pembimbing_nilai_selesai) {
                            console.log('DEBUG: Setting fpPembimbingSelesai to:', d.pembimbing_nilai_selesai);
                            fpPembimbingSelesai.setDate(d.pembimbing_nilai_selesai, false);
                        }
                        
                        // Set nilai interval penilaian pembimbing
                        if (d.pembimbing_interval_tipe) {
                            $('#pembimbing_interval_tipe').val(d.pembimbing_interval_tipe);
                        }
                        if (d.pembimbing_interval_nilai) {
                            $('#pembimbing_interval_nilai').val(d.pembimbing_interval_nilai);
                        }
                        if (d.pembimbing_hari_aktif) {
                            $('#pembimbing_hari_aktif').val(d.pembimbing_hari_aktif);
                        }
                        
                        // Auto-fill untuk tipe setiap_jam
                        if (d.pembimbing_interval_tipe === 'setiap_jam' && !d.pembimbing_interval_nilai) {
                            $('#pembimbing_interval_nilai').val('1');
                        }
                        
                        // Trigger change event untuk update UI sesuai date range
                        setTimeout(() => {
                            checkDateRangeAndToggleInterval();
                        }, 100);
                        
                        if (window.fpRevPropMulai) fpRevPropMulai.setDate(d.reviewer_proposal_mulai || null, false);
                        if (window.fpRevPropSelesai) fpRevPropSelesai.setDate(d.reviewer_proposal_selesai || null, false);
                        if (window.fpRevKemMulai) fpRevKemMulai.setDate(d.reviewer_kemajuan_mulai || null, false);
                        if (window.fpRevKemSelesai) fpRevKemSelesai.setDate(d.reviewer_kemajuan_selesai || null, false);
                        if (window.fpRevAkhMulai) fpRevAkhMulai.setDate(d.reviewer_akhir_mulai || null, false);
                        if (window.fpRevAkhSelesai) fpRevAkhSelesai.setDate(d.reviewer_akhir_selesai || null, false);
                        
                        console.log('DEBUG: Data loading completed successfully');
                    } else {
                        console.error('DEBUG: API response tidak berhasil:', response);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('DEBUG: AJAX error loading pengaturan jadwal:', {
                        xhr: xhr,
                        status: status,
                        error: error,
                        responseText: xhr.responseText
                    });
                }
            });
        }
        $('a[href="#pengaturan-jadwal"]').on('shown.bs.tab', function() {
            loadPengaturanJadwal();
        });
        $('#formPengaturanJadwal').on('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const btn = $(this).find('button[type="submit"]');
            const txt = btn.html();
            btn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Menyimpan...');
            $.ajax({
                url: '{{ url_for("admin.update_pengaturan_jadwal") }}',
                type: 'POST',
                data: new FormData(document.getElementById('formPengaturanJadwal')),
                processData: false,
                contentType: false,
                success: function(resp) {
                    if (resp.success) {
                        Swal.fire({ icon: 'success', title: 'Berhasil!', text: resp.message, timer: 1200, showConfirmButton: false });
                        loadPengaturanJadwal();
                    } else {
                        Swal.fire({ icon: 'error', title: 'Gagal!', text: resp.message });
                    }
                },
                error: function() {
                    Swal.fire({ icon: 'error', title: 'Error!', text: 'Terjadi kesalahan saat menyimpan pengaturan jadwal!' });
                },
                complete: function(){ btn.prop('disabled', false).html(txt); }
            });
        });

        // Inisialisasi Flatpickr dengan format dan lokal Indonesia
        (function initFlatpickr(){
            const opts = {
                enableTime: true,
                dateFormat: 'Y-m-d\\TH:i',
                altInput: true,
                altFormat: 'd M Y H:i',
                time_24hr: true,
                locale: flatpickr.l10ns.id
            };
            window.fpProposalMulai = flatpickr('#proposal_mulai', opts);
            window.fpProposalSelesai = flatpickr('#proposal_selesai', opts);
            window.fpKemajuanMulai = flatpickr('#kemajuan_mulai', opts);
            window.fpKemajuanSelesai = flatpickr('#kemajuan_selesai', opts);
            window.fpAkhirMulai = flatpickr('#akhir_mulai', opts);
            window.fpAkhirSelesai = flatpickr('#akhir_selesai', opts);
            // Penilaian dengan callback untuk deteksi range
            const optsWithCallback = {
                ...opts,
                onChange: function(selectedDates, dateStr, instance) {
                    checkDateRangeAndToggleInterval();
                }
            };
            
            window.fpPembimbingMulai = flatpickr('#pembimbing_nilai_mulai', optsWithCallback);
            window.fpPembimbingSelesai = flatpickr('#pembimbing_nilai_selesai', optsWithCallback);
            window.fpRevPropMulai = flatpickr('#reviewer_proposal_mulai', opts);
            window.fpRevPropSelesai = flatpickr('#reviewer_proposal_selesai', opts);
            window.fpRevKemMulai = flatpickr('#reviewer_kemajuan_mulai', opts);
            window.fpRevKemSelesai = flatpickr('#reviewer_kemajuan_selesai', opts);
            window.fpRevAkhMulai = flatpickr('#reviewer_akhir_mulai', opts);
            window.fpRevAkhSelesai = flatpickr('#reviewer_akhir_selesai', opts);
        })();

        // Load data setelah Flatpickr selesai diinisialisasi
        setTimeout(() => {
            loadPengaturanJadwal();
        }, 500);

        // Fungsi debug metadata
        function debugMetadata() {
            $.ajax({
                url: '{{ url_for("admin.debug_metadata_kolom") }}',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        console.log('DEBUG METADATA:', response);
                        Swal.fire({
                            title: 'Debug Metadata',
                            html: `
                                <div class="text-start">
                                    <p><strong>Total Metadata:</strong> ${response.metadata_count}</p>
                                    <p><strong>Periode Aktif:</strong> ${response.jadwal_info?.periode_metadata_aktif || 'N/A'}</p>
                                    <p><strong>Interval Tipe:</strong> ${response.jadwal_info?.pembimbing_interval_tipe || 'N/A'}</p>
                                    <p><strong>Interval Nilai:</strong> ${response.jadwal_info?.pembimbing_interval_nilai || 'N/A'}</p>
                                    <p><strong>Tanggal Mulai:</strong> ${response.jadwal_info?.pembimbing_nilai_mulai || 'N/A'}</p>
                                    <p><strong>Tanggal Selesai:</strong> ${response.jadwal_info?.pembimbing_nilai_selesai || 'N/A'}</p>
                                </div>
                                <details class="mt-3">
                                    <summary>Lihat Detail Metadata</summary>
                                    <pre style="max-height: 200px; overflow-y: auto; font-size: 10px;">${JSON.stringify(response.metadata_list, null, 2)}</pre>
                                </details>
                            `,
                            width: '600px',
                            confirmButtonText: 'OK'
                        });
                    } else {
                        Swal.fire({ icon: 'error', title: 'Error!', text: response.message });
                    }
                },
                error: function() {
                    Swal.fire({ icon: 'error', title: 'Error!', text: 'Terjadi kesalahan saat debug metadata!' });
                }
            });
        }

        // Fungsi untuk mengecek range tanggal dan mengatur visibility controls
        function checkDateRangeAndToggleInterval() {
            const mulaiVal = $('#pembimbing_nilai_mulai').val();
            const selesaiVal = $('#pembimbing_nilai_selesai').val();
            
            if (!mulaiVal || !selesaiVal) {
                // Jika salah satu kosong, tampilkan semua controls
                showAllIntervalControls();
                return;
            }
            
            try {
                const mulaiDate = new Date(mulaiVal);
                const selesaiDate = new Date(selesaiVal);
                
                // Bandingkan hanya tanggal (buang waktu)
                const mulaiDateOnly = new Date(mulaiDate.getFullYear(), mulaiDate.getMonth(), mulaiDate.getDate());
                const selesaiDateOnly = new Date(selesaiDate.getFullYear(), selesaiDate.getMonth(), selesaiDate.getDate());
                
                const isSameDay = mulaiDateOnly.getTime() === selesaiDateOnly.getTime();
                const daysDiff = Math.ceil((selesaiDateOnly - mulaiDateOnly) / (1000 * 60 * 60 * 24));
                
                if (isSameDay) {
                    // Tanggal sama = Mode 1 Hari
                    showSingleDayMode(mulaiDate);
                } else if (daysDiff === 1) {
                    // Range 2 hari berturut-turut = Mode Sederhana
                    showTwoDayMode(mulaiDate, selesaiDate);
                } else {
                    // Range multi-hari (3+ hari) = Mode Lengkap
                    showMultiDayMode();
                }
            } catch (e) {
                // Error parsing, tampilkan semua controls
                showAllIntervalControls();
            }
        }
        
        function showSingleDayMode(date) {
            $('#single_day_info').show();
            
            // Sembunyikan input yang tidak relevan untuk 1 hari
            $('#interval_nilai_container').hide();
            $('#hari_aktif_container').hide();
            
            // Auto-fill nilai interval untuk mode 1 hari
            $('#pembimbing_interval_nilai').val('1');
            
            // Hanya tampilkan tipe interval yang relevan
            updateIntervalTypeOptions(['setiap_jam', 'harian']);
        }
        
        function showTwoDayMode(startDate, endDate) {
            $('#single_day_info').hide();
            
            // Mode 2 hari berturut-turut - sederhanakan controls
            $('#interval_nilai_container').hide(); // Auto set ke 1
            $('#hari_aktif_container').hide(); // Auto set ke kedua hari
            
            // Auto-fill nilai interval untuk mode 2 hari
            $('#pembimbing_interval_nilai').val('1');
            
            // Hanya tampilkan tipe interval yang masuk akal untuk 2 hari
            updateIntervalTypeOptions(['harian', 'setiap_jam']);
            
            // Tampilkan info mode 2 hari
            const hari = ['', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
            const namaHari1 = hari[startDate.getDay() === 0 ? 7 : startDate.getDay()] || `Hari ${startDate.getDay() === 0 ? 7 : startDate.getDay()}`;
            const namaHari2 = hari[endDate.getDay() === 0 ? 7 : endDate.getDay()] || `Hari ${endDate.getDay() === 0 ? 7 : endDate.getDay()}`;
            showInfoMessage(`ð Mode 2 Hari: ${namaHari1} & ${namaHari2} - Pengaturan disederhanakan`);
        }
        
        function showMultiDayMode() {
            $('#single_day_info').hide();
            
            // Tampilkan semua controls untuk multi-hari
            $('#interval_nilai_container').show();
            $('#hari_aktif_container').show();
            
            // Hapus pengisian otomatis nilai - biarkan admin input manual
            // $('#pembimbing_hari_aktif').val('1,2,3,4,5');
            
            // Tampilkan semua tipe interval
            updateIntervalTypeOptions(['harian', 'mingguan', 'bulanan', 'setiap_jam']);
        }
        
        function showAllIntervalControls() {
            $('#single_day_info').hide();
            $('#interval_nilai_container').show();
            $('#hari_aktif_container').show();
            updateIntervalTypeOptions(['harian', 'mingguan', 'bulanan', 'setiap_jam']);
        }
        
        function updateIntervalTypeOptions(allowedTypes) {
            const select = $('#pembimbing_interval_tipe');
            const currentValue = select.val();
            
            // Simpan opsi yang ada
            const allOptions = {
                'harian': 'Harian',
                'mingguan': 'Mingguan', 
                'bulanan': 'Bulanan',
                'setiap_jam': 'Setiap Jam'
            };
            
            // Clear dan rebuild options
            select.empty();
            allowedTypes.forEach(type => {
                select.append(`<option value="${type}">${allOptions[type]}</option>`);
            });
            
            // Restore value jika masih valid
            if (allowedTypes.includes(currentValue)) {
                select.val(currentValue);
            } else {
                // Set default berdasarkan mode
                select.val(allowedTypes.includes('setiap_jam') && allowedTypes.length <= 2 ? 'setiap_jam' : 'harian');
            }
            
            // Auto-fill interval nilai untuk setiap_jam
            if (select.val() === 'setiap_jam') {
                $('#pembimbing_interval_nilai').val('1');
            }
        }
        
        function showInfoMessage(message) {
            // Hapus info message sebelumnya jika ada
            $('.dynamic-info-message').remove();
            
            // Tambahkan info message baru
            const infoHtml = `
                <div class="alert alert-success alert-dismissible fade show dynamic-info-message mt-2" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            $('#pembimbing_hari_aktif').closest('.row').after(infoHtml);
        }
        
        // Check saat load dan saat tab dibuka
        $(document).ready(function() {
            // Pastikan input interval kosong saat pertama kali dibuka
            $('#pembimbing_interval_nilai').val('');
            $('#pembimbing_hari_aktif').val('');
            
            // Auto-fill interval nilai saat tipe berubah
            $('#pembimbing_interval_tipe').on('change', function() {
                if ($(this).val() === 'setiap_jam') {
                    $('#pembimbing_interval_nilai').val('1');
                }
            });
            
            setTimeout(checkDateRangeAndToggleInterval, 500);
            
            // Cek status worker saat halaman dimuat
            checkWorkerStatus();
        });

        // Auto-fill Worker Functions
        function checkWorkerStatus() {
            fetch('/admin/auto_fill_status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateWorkerStatus(data.worker_running, data.message);
                    } else {
                        updateWorkerStatus(false, 'Error: ' + data.message);
                    }
                })
                .catch(error => {
                    updateWorkerStatus(false, 'Error: ' + error.message);
                });
        }

        function updateWorkerStatus(isRunning, message) {
            const statusText = document.getElementById('worker-status-text');
            const statusSpinner = document.getElementById('status-spinner');
            const startBtn = document.getElementById('start-worker-btn');
            const stopBtn = document.getElementById('stop-worker-btn');
            const infoStatus = document.getElementById('worker-info-status');

            // Update status text
            statusText.textContent = message;
            
            // Hide spinner
            statusSpinner.style.display = 'none';
            
            // Update button states
            if (isRunning) {
                startBtn.disabled = true;
                stopBtn.disabled = false;
                infoStatus.textContent = 'Berjalan';
                infoStatus.className = 'text-success fw-bold';
            } else {
                startBtn.disabled = false;
                stopBtn.disabled = true;
                infoStatus.textContent = 'Tidak Berjalan';
                infoStatus.className = 'text-danger fw-bold';
            }
        }

        function startAutoFillWorker() {
            fetch('/admin/start_auto_fill_worker', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil',
                        text: data.message,
                        timer: 2000,
                        showConfirmButton: false
                    });
                    setTimeout(checkWorkerStatus, 1000);
                } else {
                    Swal.fire('Gagal', data.message, 'error');
                }
            })
            .catch(error => {
                Swal.fire('Error', error.message || 'Terjadi kesalahan', 'error');
            });
        }

        function stopAutoFillWorker() {
            fetch('/admin/stop_auto_fill_worker', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil',
                        text: data.message,
                        timer: 2000,
                        showConfirmButton: false
                    });
                    setTimeout(checkWorkerStatus, 1000);
                } else {
                    Swal.fire('Gagal', data.message, 'error');
                }
            })
            .catch(error => {
                Swal.fire('Error', error.message || 'Terjadi kesalahan', 'error');
            });
        }

        function runAutoFillOnce() {
            Swal.fire({
                title: 'Menjalankan Auto-fill',
                text: 'Auto-fill akan dijalankan satu kali. Mohon tunggu...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            fetch('/admin/run_auto_fill_once', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil',
                        text: data.message,
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire('Gagal', data.message, 'error');
                }
            })
            .catch(error => {
                Swal.fire('Error', error.message || 'Terjadi kesalahan', 'error');
            });
        }

        function runAutoRejectOnce() {
            Swal.fire({
                title: 'Menjalankan Auto-Reject',
                text: 'Auto-reject akan dijalankan satu kali untuk mengubah status menjadi ditolak berdasarkan jadwal. Mohon tunggu...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            fetch('/admin/run_auto_reject_once', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil',
                        text: data.message,
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire('Gagal', data.message, 'error');
                }
            })
            .catch(error => {
                Swal.fire('Error', error.message || 'Terjadi kesalahan', 'error');
            });
        }
        
        function cleanupIncorrectAutoFill() {
            Swal.fire({
                title: 'Cleanup Data Auto-Fill Salah',
                text: 'Apakah Anda yakin ingin membersihkan data auto-fill yang salah (metadata_kolom_id = NULL)?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ya, Cleanup!',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/admin/cleanup_incorrect_auto_fill',
                        type: 'POST',
                        success: function(resp) {
                            if (resp.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: resp.message,
                                    timer: 3000,
                                    showConfirmButton: false
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal!',
                                    text: resp.message
                                });
                            }
                        },
                        error: function() {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Terjadi kesalahan saat cleanup data'
                            });
                        }
                    });
                }
            });
        }

        // Auto-refresh status setiap 30 detik
        setInterval(checkWorkerStatus, 30000);
        
        $('a[href="#pengaturan-jadwal-penilaian"]').on('shown.bs.tab', function(){
            setTimeout(checkDateRangeAndToggleInterval, 100);
        });

        // Helpers untuk reset terstruktur
        function clearSchedule(which) {
            const mapping = {
                proposal: ['fpProposalMulai','fpProposalSelesai'],
                kemajuan: ['fpKemajuanMulai','fpKemajuanSelesai'],
                akhir: ['fpAkhirMulai','fpAkhirSelesai']
            };
            const mappingInputs = {
                proposal: ['#proposal_mulai','#proposal_selesai'],
                kemajuan: ['#kemajuan_mulai','#kemajuan_selesai'],
                akhir: ['#akhir_mulai','#akhir_selesai']
            };
            const clearInstances = (keys) => keys.forEach(key => { if (window[key]) window[key].clear(); });
            const clearInputs = (selectors) => selectors.forEach(sel => { const el = document.querySelector(sel); if (el) el.value = ''; });
            if (which === 'all') {
                clearInstances(Object.values(mapping).flat());
                clearInputs(Object.values(mappingInputs).flat());
                return;
            }
            clearInstances(mapping[which] || []);
            clearInputs(mappingInputs[which] || []);
        }

        // Helpers untuk jadwal penilaian
        function clearSchedulePenilaian(which) {
            const mapping = {
                pembimbing: ['fpPembimbingMulai','fpPembimbingSelesai'],
                reviewer_proposal: ['fpRevPropMulai','fpRevPropSelesai'],
                reviewer_kemajuan: ['fpRevKemMulai','fpRevKemSelesai'],
                reviewer_akhir: ['fpRevAkhMulai','fpRevAkhSelesai']
            };
            const mappingInputs = {
                pembimbing: ['#pembimbing_nilai_mulai','#pembimbing_nilai_selesai','#pembimbing_interval_tipe','#pembimbing_interval_nilai','#pembimbing_hari_aktif'],
                reviewer_proposal: ['#reviewer_proposal_mulai','#reviewer_proposal_selesai'],
                reviewer_kemajuan: ['#reviewer_kemajuan_mulai','#reviewer_kemajuan_selesai'],
                reviewer_akhir: ['#reviewer_akhir_mulai','#reviewer_akhir_selesai']
            };
            const clearInstances = (keys) => keys.forEach(key => { if (window[key]) window[key].clear(); });
            const clearInputs = (selectors) => selectors.forEach(sel => { const el = document.querySelector(sel); if (el) el.value = ''; });
            if (which === 'all') {
                clearInstances(Object.values(mapping).flat());
                clearInputs(Object.values(mappingInputs).flat());
                return;
            }
            clearInstances(mapping[which] || []);
            clearInputs(mappingInputs[which] || []);
        }

        function loadPengaturanJadwalPenilaian(){
            $.get('{{ url_for("admin.get_pengaturan_jadwal") }}').done(function(resp){
                if (!resp || !resp.success) return;
                const d = resp.data || {};
                if (window.fpPembimbingMulai) fpPembimbingMulai.setDate(d.pembimbing_nilai_mulai || null, false);
                if (window.fpPembimbingSelesai) fpPembimbingSelesai.setDate(d.pembimbing_nilai_selesai || null, false);
                
                // Load interval settings
                $('#pembimbing_interval_tipe').val(d.pembimbing_interval_tipe || 'harian');
                // Hapus fallback value - biarkan kosong jika tidak ada data
                $('#pembimbing_interval_nilai').val(d.pembimbing_interval_nilai || '');
                $('#pembimbing_hari_aktif').val(d.pembimbing_hari_aktif || '');
                
                if (window.fpRevPropMulai) fpRevPropMulai.setDate(d.reviewer_proposal_mulai || null, false);
                if (window.fpRevPropSelesai) fpRevPropSelesai.setDate(d.reviewer_proposal_selesai || null, false);
                if (window.fpRevKemMulai) fpRevKemMulai.setDate(d.reviewer_kemajuan_mulai || null, false);
                if (window.fpRevKemSelesai) fpRevKemSelesai.setDate(d.reviewer_kemajuan_selesai || null, false);
                if (window.fpRevAkhMulai) fpRevAkhMulai.setDate(d.reviewer_akhir_mulai || null, false);
                if (window.fpRevAkhSelesai) fpRevAkhSelesai.setDate(d.reviewer_akhir_selesai || null, false);
            });
        }
        $('a[href="#pengaturan-jadwal-penilaian"]').on('shown.bs.tab', function(){
            loadPengaturanJadwalPenilaian();
        });

        $('#formPengaturanJadwalPenilaian').on('submit', function(e){
            e.preventDefault();
            const btn = $(this).find('button[type="submit"]');
            const txt = btn.html();
            btn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Menyimpan...');
            const fd = new FormData(this);
            $.ajax({
                url: '{{ url_for("admin.update_pengaturan_jadwal") }}',
                type: 'POST',
                data: fd,
                processData: false,
                contentType: false,
                success: function(resp){
                    if (resp.success) {
                        Swal.fire({ icon: 'success', title: 'Berhasil!', text: resp.message, timer: 1200, showConfirmButton: false });
                        loadPengaturanJadwalPenilaian();
                        try {
                            const tabEl = document.querySelector('a[href="#pengaturan-jadwal-penilaian"]');
                            if (tabEl && window.bootstrap && bootstrap.Tab) bootstrap.Tab.getOrCreateInstance(tabEl).show();
                            localStorage.setItem('admin_pengaturan_active_tab', '#pengaturan-jadwal-penilaian');
                        } catch(e){}
                    } else {
                        Swal.fire({ icon: 'error', title: 'Gagal!', text: resp.message });
                    }
                },
                error: function(){
                    Swal.fire({ icon: 'error', title: 'Error!', text: 'Terjadi kesalahan saat menyimpan jadwal penilaian!' });
                },
                complete: function(){ btn.prop('disabled', false).html(txt); }
            });
        });
        
        // Set default skor saat modal tambah pertanyaan dibuka
        $('#modalTambahPertanyaanMahasiswa').on('show.bs.modal', function() {
            const defaultSkor = localStorage.getItem('default_skor_mahasiswa') || 100;
            $('#skor_mahasiswa_value').text(defaultSkor);
            $('#skor_mahasiswa').val(defaultSkor);
        });
        
        $('#modalTambahPertanyaanProposal').on('show.bs.modal', function() {
            const defaultSkor = localStorage.getItem('default_skor_proposal') || 100;
            $('#skor_proposal_value').text(defaultSkor);
            $('#skor_proposal').val(defaultSkor);
        });
        
        $('#modalTambahPertanyaanLaporanKemajuan').on('show.bs.modal', function() {
            const defaultSkor = localStorage.getItem('default_skor_laporan_kemajuan') || 100;
            $('#skor_laporan_kemajuan_value').text(defaultSkor);
            $('#skor_laporan_kemajuan').val(defaultSkor);
        });
        
        $('#modalTambahPertanyaanLaporanAkhir').on('show.bs.modal', function() {
            const defaultSkor = localStorage.getItem('default_skor_laporan_akhir') || 100;
            $('#skor_laporan_akhir_value').text(defaultSkor);
            $('#skor_laporan_akhir').val(defaultSkor);
        });
        

        
        // Load pengaturan default saat halaman dimuat
        loadPengaturanDefault();
        
        // Reset form untuk modal penilaian
        $('#modalTambahPertanyaanMahasiswa, #modalEditPertanyaanMahasiswa').on('hidden.bs.modal', function() {
            $(this).find('form')[0].reset();
        });

        $('#modalTambahPertanyaanProposal, #modalEditPertanyaanProposal').on('hidden.bs.modal', function() {
            $(this).find('form')[0].reset();
        });

        $('#modalTambahPertanyaanLaporanKemajuan, #modalEditPertanyaanLaporanKemajuan').on('hidden.bs.modal', function() {
            $(this).find('form')[0].reset();
        });

        $('#modalTambahPertanyaanLaporanAkhir, #modalEditPertanyaanLaporanAkhir').on('hidden.bs.modal', function() {
            $(this).find('form')[0].reset();
        });


        // ========================================
        // PENGATURAN ANGGARAN (Min/Max)
        // ========================================
        function loadPengaturanAnggaran() {
            $.ajax({
                url: '{{ url_for("admin.get_pengaturan_anggaran") }}',
                type: 'GET',
                success: function(resp) {
                    if (resp.success && resp.data) {
                        $('#min_total_awal').val(resp.data.min_total_awal || 0);
                        $('#max_total_awal').val(resp.data.max_total_awal || 0);
                        $('#min_total_bertumbuh').val(resp.data.min_total_bertumbuh || 0);
                        $('#max_total_bertumbuh').val(resp.data.max_total_bertumbuh || 0);
                    }
                }
            });
        }
        $('a[href="#pengaturan-anggaran"]').on('shown.bs.tab', function(){
            loadPengaturanAnggaran();
        });
        $('#formPengaturanAnggaran').on('submit', function(e){
            e.preventDefault();
            const btn = $(this).find('button[type="submit"]');
            const txt = btn.html();
            btn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Menyimpan...');
            const fd = new FormData(this);
            $.ajax({
                url: '{{ url_for("admin.update_pengaturan_anggaran") }}',
                type: 'POST',
                data: fd,
                processData: false,
                contentType: false,
                success: function(resp){
                    if (resp.success) {
                        Swal.fire({ icon: 'success', title: 'Berhasil!', text: resp.message, timer: 1200, showConfirmButton: false });
                        loadPengaturanAnggaran();
                        try {
                            const tabEl = document.querySelector('a[href="#pengaturan-anggaran"]');
                            if (tabEl && window.bootstrap && bootstrap.Tab) bootstrap.Tab.getOrCreateInstance(tabEl).show();
                            localStorage.setItem('admin_pengaturan_active_tab', '#pengaturan-anggaran');
                        } catch(e){}
                    } else {
                        Swal.fire({ icon: 'error', title: 'Gagal!', text: resp.message });
                    }
                },
                error: function(){
                    Swal.fire({ icon: 'error', title: 'Error!', text: 'Terjadi kesalahan saat menyimpan pengaturan anggaran!' });
                },
                complete: function(){ btn.prop('disabled', false).html(txt); }
            });
        });
    </script>

</body>

</html>
